
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Interpretabilidade de Modelos &#8212; Machine Learning e Estatística do zero</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ml-book/advanced/01.projeto-01-interpretabilidade_modelos';</script>
    <link rel="canonical" href="https://manuelfjr.github.io/machine-learning-stats/ml-book/advanced/01.projeto-01-interpretabilidade_modelos.html" />
    <link rel="icon" href="../../_static/github.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Referências" href="../_bibliography/references.html" />
    <link rel="prev" title="Aprendizado Supervisionado" href="../guide/02_notebooks.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo_new.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../../_static/logo_new.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">Machine Learning e Estatística do zero</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../guide/01_first.html">Machine Learning</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../guide/02_notebooks.html">Aprendizado Supervisionado</a></li>
</ul>
</li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Interpretabilidade de Modelos</a></li>









<li class="toctree-l1"><a class="reference internal" href="../_bibliography/references.html">Referências</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/manuelfjr/machine-learning-stats/master?urlpath=tree/ml-book/advanced/01.projeto-01-interpretabilidade_modelos.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/manuelfjr/machine-learning-stats/blob/master/ml-book/advanced/01.projeto-01-interpretabilidade_modelos.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/manuelfjr/machine-learning-stats" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/manuelfjr/machine-learning-stats/edit/main/ml-book/advanced/01.projeto-01-interpretabilidade_modelos.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/manuelfjr/machine-learning-stats/issues/new?title=Issue%20on%20page%20%2Fml-book/advanced/01.projeto-01-interpretabilidade_modelos.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/ml-book/advanced/01.projeto-01-interpretabilidade_modelos.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Interpretabilidade de Modelos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Interpretabilidade de Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-01">Projeto 01</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao">Introdução</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracoes">0. Configurações</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">0.1 Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">0.2 Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">0.3 Parameters</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#selecao-de-modelos">1. Seleção de modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-e-metricas">1.1 Modelos e métricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-dataset">1.2 Preparando dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#process-dataset">1.2.1 Process dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#split">1.2.2 Split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holdout">1.2.3 Holdout</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelagem">1.3 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit">1.3.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics">1.3.2 Metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">1.3.3 Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-confusao">1.3.4 Matriz de confusão</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arvore-compacta">1.3.5 Arvore compacta</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curva-roc">1.3.6 Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">1.4 Cross-validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusoes">1.5 Conclusões</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#surrogates">2. Surrogates</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-black-box-and-white-box-sem-aplicar-pca">2.1.1 Fit <em>black-box</em> and <em>white-box</em> (sem aplicar PCA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicando-pca">2.1.2 Aplicando <em>PCA</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficos">2.1.3 Gráficos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.4 Overview</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arvore-de-decisao">2.2 Arvore de decisão</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ambos-modelos-black-box">2.2.1 Ambos modelos <em>black box</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#superficie-de-separacao">2.3 Superficie de separação</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aproximando-o-white-box">2.3.1 Aproximando o <em>white box</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aumentando-o-numero-de-dados">2.3.2 Aumentando o número de dados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predicoes">2.3.3 Predições</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot">2.3.4 Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.4 Conclusões</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">3. Feature Importances</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">3.1 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">3.1.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avaliando">3.1.2 Avaliando</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permutation-feature-importance-pfi">3.2 Permutation Feature Importance (PFI)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-model">3.2.1 Full model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-classe">3.2.2 Por classe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analise">3.2.3 Analise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">3.3 Gráficos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacao">3.3.1 Visualização</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.3.2 Analise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionado-features-com-importancia-positiva">3.4 Selecionado Features com importancia positiva</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3.4.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avaliacao">3.4.2 Avaliação</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">3.4.3 Conclusões</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-dependence-plots-pdps-e-individual-conditional-expectation-ices">4. Partial Dependence Plots (PDPs) e Individual Conditional Expectation(ICEs)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-da-distribuicao-das-variaveis">4.1 Analise da distribuicao das variaveis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">4.1.1 Boxplot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heatmap-das-correlacoes">4.1.2 Heatmap das correlacoes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-dependence-plot-pdps">4.2 Partial Dependence Plot (PDPs)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#individual-conditional-expectation-ice">4.3. Individual Conditional Expectation (ICE)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusao">4.4 Conclusão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#local-interpretable-model-agnostic-explanations-lime">5. Local Interpretable Model-Agnostic Explanations (LIME)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-instancias">5.1 Selecionando instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">5.1.1 Aplicando PCA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-as-instancias-mais-representativas-por-classe">5.1.2 Selecionando as instancias mais representativas por classe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizando">5.1.3 Visualizando</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilizando-as-probabilidades-de-pertencimento-a-classe-positiva">5.1.4 Utilizando as probabilidades de pertencimento a classe positiva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-mais-algumas-instancias">5.1.5 Selecionando mais algumas instâncias</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lime">5.2 LIME</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-a-classe-criada-para-o-lime">5.2.1 Fit a classe criada para o LIME</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-instance-para-cada-uma-das-situacoes-da-secao-anterior">5.2.2 Explain Instance: para cada uma das situações da seção anterior</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centroide-da-classe-negativa">5.2.2.1 Centroide da classe negativa</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centroide-da-classe-positiva">5.2.2.2 Centroide da classe positiva</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-mais-distante-do-grupo-positivo">5.2.2.3 Instância mais distante do grupo positivo</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-no-ponto-medio-entre-os-centroides">5.2.2.4 Instância no ponto médio entre os centroides</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-em-regiao-com-overlapping">5.2.2.5 Instância em região com overlapping</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overall">5.2.2.6 Overall</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">5.2.3 Conclusão</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">6. Conclusões</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="interpretabilidade-de-modelos">
<h1>Interpretabilidade de Modelos<a class="headerlink" href="#interpretabilidade-de-modelos" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://github.com/Manuelfjr/topicos_avancados_ic_ii/tree/develop">Tópicos Avançados em Inteligência Computacional 2</a></p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="projeto-01">
<h1>Projeto 01<a class="headerlink" href="#projeto-01" title="Link to this heading">#</a></h1>
<p><strong>[Interpretabilidade de Modelos]</strong></p>
<p>descrição:</p>
<ol class="arabic simple">
<li><p>Escolha uma base de dados do seu interesse e construa modelos preditivos.</p></li>
<li><p>Trabalhe agora com os aspectos de interpretabilidade principais explorados em sala. Discuta o que o modelo aprendeu, como ele realiza suas predições, quais as variáveis mais importantes,… dentre outros aspectos que ajude a entender o comportamento do modelo enquanto realiza suas predições.</p></li>
</ol>
<p>Obs.: a entrega será feita como um notebook comentado com os insights obtidos. Mais que gerar gráficos e estatísticas, é importante que se analise os resultados obtidos e que se apontem as conclusões mais importantes.</p>
<p>Obs.: será feita uma apresentação rápida em sala (10 a 15 minutos por pessoa, em ordem definida em sorteio), mas a entrega do relatório será uniforme (no dia 17 de abril até as 13h).</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introducao">
<h1>Introdução<a class="headerlink" href="#introducao" title="Link to this heading">#</a></h1>
<p>O conjunto utilizado para o trabalho, será o mesmo das atividades anteiores, <em>Breast Cancer  Wisconsin</em>. As variáveis estão sendo descritas abaixo.</p>
<ul class="simple">
<li><p><strong>dataset</strong>:  Breast cancer wisconsin (diagnostic)</p></li>
<li><p><strong>Attribute Information</strong>:</p>
<ul>
<li><p>radius (mean of distances from center to points on the perimeter)</p></li>
<li><p>texture (standard deviation of gray-scale values)</p></li>
<li><p>perimeter</p></li>
<li><p>area</p></li>
<li><p>smoothness (local variation in radius lengths)</p></li>
<li><p>compactness (perimeter^2 / area - 1.0)</p></li>
<li><p>concavity (severity of concave portions of the contour)</p></li>
<li><p>concave points (number of concave portions of the contour)</p></li>
<li><p>symmetry</p></li>
<li><p>fractal dimension (“coastline approximation” - 1)</p></li>
</ul>
</li>
</ul>
<p>The mean, standard error, and “worst” or largest (mean of the three worst/largest values) of these features were computed for each image, resulting in 30 features. For instance, field 0 is Mean Radius, field 10 is Radius SE, field 20 is Worst Radius.</p>
<ul class="simple">
<li><p><strong>class</strong>:</p>
<ul>
<li><p>WDBC-Malignant (0)</p></li>
<li><p>WDBC-Benign (1)</p></li>
</ul>
</li>
</ul>
<p>Durante o decorrer do trabalho, será replicado as aplicações desenvolvidas nas ultimas atividades, retirando as devidas interpretações dos resultados obtidos.</p>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="configuracoes">
<h1>0. Configurações<a class="headerlink" href="#configuracoes" title="Link to this heading">#</a></h1>
<section id="imports">
<h2>0.1 Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">lime</span> <span class="kn">import</span> <span class="n">lime_tabular</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span><span class="p">,</span> <span class="n">make_circles</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.inspection</span> <span class="kn">import</span> <span class="n">PartialDependenceDisplay</span><span class="p">,</span> <span class="n">permutation_importance</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span><span class="n">RocCurveDisplay</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">auc</span><span class="p">,</span>
                             <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">make_scorer</span><span class="p">,</span>
                             <span class="n">precision_recall_curve</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span>
                             <span class="n">recall_score</span><span class="p">,</span> <span class="n">roc_auc_score</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span><span class="p">,</span> <span class="n">plot_tree</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">lime</span> <span class="kn">import</span> <span class="n">lime_tabular</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pandas&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="methods">
<h2>0.2 Methods<a class="headerlink" href="#methods" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">set_root</span><span class="p">(</span><span class="n">level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">return_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adiciona o diretório raiz do projeto ao sys.path.</span>

<span class="sd">    Esta função adiciona o diretório raiz do projeto ao sys.path para permitir</span>
<span class="sd">    a importação de módulos de outros diretórios do projeto.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">        level (int): O nível do diretório raiz em relação ao diretório atual.</span>
<span class="sd">                     O padrão é 1, o que significa que o diretório imediatamente</span>
<span class="sd">                     superior será considerado como o diretório raiz.</span>
<span class="sd">        return_path (bool): Se True, a função retorna o caminho do diretório raiz.</span>
<span class="sd">                            Caso contrário, retorna None. O padrão é False.</span>

<span class="sd">    Return:</span>
<span class="sd">    -----------</span>
<span class="sd">        Any: O caminho do diretório raiz, se return_path for True. Caso contrário, None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="n">PROJECT_DIR</span><span class="o">.</span><span class="n">parent</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">PROJECT_DIR</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">return_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PROJECT_DIR</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_pca</span><span class="p">(</span>
        <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">X_test</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ncomponents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">transform</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">ncomponents</span><span class="p">)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">X_test</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span>


<span class="k">def</span> <span class="nf">train_surrogates</span><span class="p">(</span>
    <span class="n">white_box</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">black_box</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">y_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">X_test</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Treina surrogates para aproximar modelos caixa preta.</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        white_box (dict): Um dicionário para os surrogates.</span>
<span class="sd">        black_box (dict): Um dicionário de modelos caixa preta.</span>
<span class="sd">        X_train (DataFrame ou ndarray): Dados de treinamento.</span>
<span class="sd">        y_train (DataFrame ou ndarray): Rótulos de treinamento.</span>
<span class="sd">        X_test (DataFrame ou ndarray): Dados de teste.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        Tuple: Um tuple contendo os surrogates treinados, previsões dos modelos</span>
<span class="sd">                caixa branca efetua as previsões dos modelos caixa preta.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">black_yhat</span><span class="p">,</span> <span class="n">white_yhat</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
    <span class="n">white_box_models</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">w_name</span><span class="p">,</span> <span class="n">white_model</span> <span class="ow">in</span> <span class="n">white_box</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">white_yhat</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">white_box_models</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">b_name</span><span class="p">,</span> <span class="n">black_model</span> <span class="ow">in</span> <span class="n">black_box</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">black_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
            <span class="n">black_yhat</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">black_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

            <span class="n">white_model</span> <span class="o">=</span> <span class="n">white_model</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="o">**</span><span class="n">white_model</span><span class="o">.</span><span class="n">get_params</span><span class="p">())</span>
            <span class="n">white_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">black_yhat</span><span class="p">[</span><span class="n">b_name</span><span class="p">])</span>
            <span class="n">white_yhat</span><span class="p">[</span><span class="n">w_name</span><span class="p">][</span><span class="n">b_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">white_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
            <span class="n">white_box_models</span><span class="p">[</span><span class="n">w_name</span><span class="p">][</span><span class="n">b_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">white_model</span>

    <span class="k">return</span> <span class="n">white_box_models</span><span class="p">,</span> <span class="n">black_box</span><span class="p">,</span> <span class="n">white_yhat</span><span class="p">,</span> <span class="n">black_yhat</span>


<span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span>
    <span class="n">black_yhat</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">white_yhat</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
    <span class="n">test_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">tick_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]],</span>
    <span class="n">_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">show_complete_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot o resultado do black box e do white box</span>

<span class="sd">    Parameters:</span>
<span class="sd">        black_yhat (Dict[str, np.ndarray]): Dicionario de predições par ao modelo black box.</span>
<span class="sd">        white_yhat (Dict[str, Dict[str, np.ndarray]]): Dicionario de predicoes para o surrogate.</span>
<span class="sd">        test_data (np.ndarray): Dados de teste.</span>
<span class="sd">        tick_params (Dict[str, Union[str, int, float, bool]]): tick marks.</span>
<span class="sd">        _names (Dict[str, str]): Dicionario para &quot;de para&quot; nos nomes.</span>
<span class="sd">        show_complete_title (boolean): Boleano para caso queira mostrar os titulos dos white box completo</span>
<span class="sd">        kwargs: parametros para o matplotlib.pyplot.subplots</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[plt.Figure, np.ndarray]: Tuplca contendo a figura e a imagem.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">white_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">axes</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">white_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">bidx</span><span class="p">,</span> <span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">b_yhat</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">widx</span><span class="p">,</span> <span class="p">(</span><span class="n">w_name</span><span class="p">,</span> <span class="n">w_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">white_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_complete_title</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Surrogate: $</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;_{acc=&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">b_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;}$&quot;</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="n">text</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;_{acc=&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">b_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;}$&quot;</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                    <span class="n">text</span>
                <span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="p">:]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Black box: </span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>


<span class="k">def</span> <span class="nf">plot_simulation_results</span><span class="p">(</span>
    <span class="n">bs_yhat</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">ws_yhat</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]],</span>
    <span class="n">X_simulated</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">tick_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]],</span>
    <span class="n">_names</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">show_complete_title</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot resultado das simulacoes</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        bs_yhat (Dict[str, np.ndarray]): Dicionário de previsões dos modelos black box.</span>
<span class="sd">        ws_yhat (Dict[str, Dict[str, np.ndarray]]): Dicionário de previsões do surrogate.</span>
<span class="sd">        X_simulated (np.ndarray): Dados simulados.</span>
<span class="sd">        tick_params (Dict[str, Union[str, int, float, bool]]): Parâmetros para os marcadores.</span>
<span class="sd">        _names (Dict[str, str]): Dicionário mapeando nomes de modelos para nomes conhecidos.</span>
<span class="sd">        show_complete_title (boolean): Boleano para caso queira o nome completo do modelo no grafico.</span>
<span class="sd">        **kwargs: Argumentos para a função subplots.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        Tuple[plt.Figure, np.ndarray]: Tupla contendo a figura e os eixos do gráfico.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">axes</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">axes</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">bidx</span><span class="p">,</span> <span class="p">(</span><span class="n">bs_name</span><span class="p">,</span> <span class="n">s_yhat</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bs_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">s_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">s_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;bs&quot;</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">s_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">s_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span>
            <span class="s2">&quot;g^&quot;</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">widx</span><span class="p">,</span> <span class="p">(</span><span class="n">ws_name</span><span class="p">,</span> <span class="n">ws_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ws_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;bs&quot;</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">X_simulated</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;g^&quot;</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_complete_title</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Surrogate: $</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;_{acc=&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">s_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;}$&quot;</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;_{acc=&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">s_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">ws_model</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;}$&quot;</span>
                <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">bs_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="p">:]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Black box: </span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">add_pca</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>         <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>         <span class="n">X_test</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>         <span class="n">transform</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="n">ncomponents</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">transform</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>         <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_color_range</span><span class="p">(</span>
        <span class="n">color1_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">color2_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_colors</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gera uma lista de cores intermediárias entre duas cores fornecidas.</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        color1_name (str): Nome da primeira cor.</span>
<span class="sd">        color2_name (str): Nome da segunda cor.</span>
<span class="sd">        num_colors (int): Número de cores intermediárias a serem geradas.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        List[Tuple[int, int, int]]: Uma lista de tuplas representando as cores intermediárias no formato (R, G, B).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Converter nomes de cores em valores RGB</span>
    <span class="n">color1_rgb</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color1_name</span><span class="p">)</span>
    <span class="n">color2_rgb</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">color2_name</span><span class="p">)</span>

    <span class="c1"># Gerar a lista de cores intermediárias</span>
    <span class="n">color_range</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_colors</span><span class="p">):</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">num_colors</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">color1_rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">color2_rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">color1_rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">color2_rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">color1_rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ratio</span><span class="p">)</span> <span class="o">+</span> <span class="n">color2_rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span>
        <span class="n">color_range</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">color_range</span>


<span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">which_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accuracy_score&quot;</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">},</span>
        <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calcula as métricas especificadas usando validação cruzada e retorna um DataFrame.</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        model (estimator): O modelo de aprendizado de máquina a ser avaliado.</span>
<span class="sd">        X (array-like): As features do conjunto de dados.</span>
<span class="sd">        y (array-like): Os rótulos do conjunto de dados.</span>
<span class="sd">        cv (int ou iterável): O esquema de validação cruzada a ser utilizado.</span>
<span class="sd">        which_metrics (dict): Um dicionário onde as chaves são os nomes das</span>
<span class="sd">                                métricas e os valores são as funções de métrica.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        pd.DataFrame: Um DataFrame contendo as métricas calculadas.</span>

<span class="sd">    Exemplo:</span>
<span class="sd">        metrics = {</span>
<span class="sd">            &#39;accuracy&#39;: accuracy_score,</span>
<span class="sd">            &#39;precision&#39;: precision_score,</span>
<span class="sd">            &#39;recall&#39;: recall_score</span>
<span class="sd">        }</span>
<span class="sd">        results = calculate_metrics(model, X, y, cv=5, which_metrics=metrics)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">which_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Cros-validation&quot;</span><span class="p">):</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">make_scorer</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">metric</span><span class="p">)))]</span>
        <span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">==</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">index_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;all_features&quot;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">index_name</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;partial_features&quot;</span><span class="p">]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">plot_bar_chart</span><span class="p">(</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">ordered_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">colors</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
        <span class="n">bar_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.35</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plota um gráfico de barras a partir dos dados fornecidos.</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        groups (DataFrame): Os dados a serem plotados.</span>
<span class="sd">        ordered_features (list): Lista das características ordenadas.</span>
<span class="sd">        colors (list): Lista de cores para cada grupo.</span>
<span class="sd">        **kwargs: Argumentos adicionais a serem passados para a função de barra.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        plt.Figure: A figura do gráfico de barras plotado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig_bar</span><span class="p">,</span> <span class="n">ax_bar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ax_bar</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">index</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bar_width</span><span class="p">,</span>
            <span class="n">groups</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ordered_features</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)],</span>
            <span class="n">yerr</span><span class="o">=</span><span class="n">groups</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ordered_features</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;importances_std&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)],</span>
            <span class="n">width</span><span class="o">=</span><span class="n">bar_width</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="n">ax_bar</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia Média&#39;</span><span class="p">)</span>
    <span class="n">ax_bar</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Importancia das Features por classe. (n_features = </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ordered_features</span><span class="p">)))</span>
    <span class="n">ax_bar</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="n">bar_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">ax_bar</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ordered_features</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">)</span>
    <span class="n">ax_bar</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
    <span class="n">ax_bar</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">fig_bar</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig_bar</span><span class="p">,</span> <span class="n">ax_bar</span>


<span class="k">def</span> <span class="nf">plot_heatmap</span><span class="p">(</span>
        <span class="n">groups</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">y</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plota um heatmap a partir dos dados fornecidos.</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">        groups (DataFrame): Os dados a serem plotados.</span>
<span class="sd">        y (ndarray): O array de rótulos.</span>
<span class="sd">        axes_hm (Axes): O objeto de eixo do heatmap.</span>
<span class="sd">        **kwargs: Argumentos adicionais a serem passados para a função de heatmap.</span>

<span class="sd">    Retorna:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig_hm</span><span class="p">,</span> <span class="n">axes_hm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">)],</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes_hm</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">axes_hm</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">axes_hm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Feature Permutation Importance por classe. (n_features = </span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig_hm</span><span class="p">,</span> <span class="n">axes_hm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">38</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>         <span class="n">color_range</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>     <span class="k">return</span> <span class="n">color_range</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="k">def</span> <span class="nf">calculate_metrics</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>         <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span>         <span class="n">X</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>         <span class="n">y</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>         <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<span class="ne">---&gt; </span><span class="mi">38</span>         <span class="n">which_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accuracy_score&quot;</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">},</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>         <span class="n">cv</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span><span class="sd">     Calcula as métricas especificadas usando validação cruzada e retorna um DataFrame.</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="sd">         results = calculate_metrics(model, X, y, cv=5, which_metrics=metrics)</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>     <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

<span class="ne">NameError</span>: name &#39;accuracy_score&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">create_pdp_subplots</span><span class="p">(</span>
        <span class="n">selected_features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
        <span class="n">model</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
        <span class="n">X_test_feats</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
        <span class="n">corr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">a_</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
        <span class="n">b_</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cria subplots para Gráficos de Dependência Parcial (PDP).</span>

<span class="sd">    Parâmetros:</span>
<span class="sd">    -----------</span>
<span class="sd">    selected_features : Union[list, np.array]</span>
<span class="sd">        Lista ou array de características selecionadas.</span>
<span class="sd">    model : any</span>
<span class="sd">        Modelo de aprendizado de máquina treinado.</span>
<span class="sd">    X_test_feats : Union[np.array, pd.DataFrame]</span>
<span class="sd">        Matriz de características para dados de teste.</span>
<span class="sd">    corr : bool, opcional</span>
<span class="sd">        Se deve calcular correlações entre características, por padrão True.</span>

<span class="sd">    Retorna:</span>
<span class="sd">    --------</span>
<span class="sd">    fig_pdp : matplotlib.figure.Figure</span>
<span class="sd">        Objeto de figura para os subgráficos PDP.</span>
<span class="sd">    axes_pdp : matplotlib.axes.Axes</span>
<span class="sd">        Objeto de eixos para os subgráficos PDP.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
        <span class="n">X_feats_corr</span> <span class="o">=</span> <span class="n">X_test_feats</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

    <span class="n">fig_pdp</span><span class="p">,</span> <span class="n">axes_pdp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">),</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">),</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">__func</span><span class="p">(</span><span class="n">a_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">)),</span> <span class="n">__func</span><span class="p">(</span><span class="n">b_</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_features</span><span class="p">)))</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">idx_row</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_features</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx_col</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_features</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">PartialDependenceDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
                    <span class="n">model</span><span class="p">,</span>
                    <span class="n">X_test_feats</span><span class="p">,</span>
                    <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)],</span>
                    <span class="n">grid_resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">axes_pdp</span><span class="p">[</span><span class="n">idx_row</span><span class="p">,</span> <span class="n">idx_col</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>
                    <span class="n">axes_pdp</span><span class="p">[</span><span class="n">idx_row</span><span class="p">,</span> <span class="n">idx_col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">rho_{x,y}$ = &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">X_feats_corr</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_pdp</span><span class="p">,</span> <span class="n">axes_pdp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">__func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span> <span class="o">//</span> <span class="n">b</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span> <span class="nf">create_pdp_subplots</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>         <span class="n">selected_features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>         <span class="n">model</span><span class="p">:</span> <span class="nb">any</span><span class="p">,</span>
<span class="ne">----&gt; </span><span class="mi">8</span>         <span class="n">X_test_feats</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="n">corr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>         <span class="n">a_</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>         <span class="n">b_</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span><span class="sd">     Cria subplots para Gráficos de Dependência Parcial (PDP).</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span><span class="sd">         Objeto de eixos para os subgráficos PDP.</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>     <span class="k">if</span> <span class="n">corr</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">LimeExplainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe para explicação de instâncias específicas usando Lime.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    -----------</span>
<span class="sd">        X_train: Union[pd.DataFrame, np.ndarray]</span>
<span class="sd">            Conjunto de dados de treinamento.</span>
<span class="sd">        features: Union[list, np.ndarray]</span>
<span class="sd">            Lista de nomes das características.</span>
<span class="sd">        model: any</span>
<span class="sd">            Modelo de machine learning a ser explicado.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa a classe LimeExplainer.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            X_train: Union[pd.DataFrame, np.ndarray]</span>
<span class="sd">                Conjunto de dados de treinamento.</span>
<span class="sd">            features: Union[list, np.ndarray]</span>
<span class="sd">                Lista de nomes das características.</span>
<span class="sd">            model: any</span>
<span class="sd">                Modelo de machine learning a ser explicado.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifis_instance</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_ifis_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifica se os dados são um DataFrame ou uma matriz numpy e retorna a parte correspondente.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            data: Union[pd.DataFrame, np.ndarray]</span>
<span class="sd">                Dados a serem verificados.</span>
<span class="sd">            features: Union[list, np.ndarray], opcional</span>
<span class="sd">                Lista de nomes das características.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            Union[np.ndarray]</span>
<span class="sd">                Dados correspondentes ao tipo de entrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">features</span> <span class="o">!=</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">features</span> <span class="o">!=</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">features</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">features</span> <span class="o">==</span> <span class="p">[]):</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ajusta o explainer LimeTabularExplainer.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            features: Union[list, np.ndarray]</span>
<span class="sd">                Lista de nomes das características.</span>
<span class="sd">            **kwargs</span>
<span class="sd">                Outros argumentos opcionais para passar para LimeTabularExplainer.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            LimeExplainer</span>
<span class="sd">                Retorna a própria instância da classe LimeExplainer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explainer</span> <span class="o">=</span> <span class="n">lime_tabular</span><span class="o">.</span><span class="n">LimeTabularExplainer</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X_train</span><span class="p">,</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">explain_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Explica uma instância específica usando Lime.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            instance: Union[pd.DataFrame, np.ndarray]</span>
<span class="sd">                Instância específica para explicação.</span>
<span class="sd">            show: bool, opcional</span>
<span class="sd">                Se True, exibe a explicação na forma de um notebook interativo.</span>
<span class="sd">            **kwargs</span>
<span class="sd">                Outros argumentos opcionais para passar para explain_instance.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            tuple</span>
<span class="sd">                Uma tupla contendo a explicação gerada pelo Lime e a instância específica.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_ifis_instance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">,</span>
            <span class="n">num_features</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mostra a explicação gerada pelo Lime na forma de um notebook interativo.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">            **kwargs</span>
<span class="sd">                Outros argumentos opcionais para passar para show_in_notebook.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            LimeExplainer</span>
<span class="sd">                Retorna a própria instância da classe LimeExplainer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">show_in_notebook</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">class</span> <span class="nc">LimeExplainer</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span><span class="sd">     Classe para explicação de instâncias específicas usando Lime.</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd">             Modelo de machine learning a ser explicado.</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">any</span><span class="p">):</span>

<span class="nn">Cell In[6], line 15,</span> in <span class="ni">LimeExplainer</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">class</span> <span class="nc">LimeExplainer</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span><span class="sd">     Classe para explicação de instâncias específicas usando Lime.</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span><span class="sd">             Modelo de machine learning a ser explicado.</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">15</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_train</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">features</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="nb">any</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span><span class="sd">         Inicializa a classe LimeExplainer.</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span><span class="sd">                 Modelo de machine learning a ser explicado.</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span>         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="parameters">
<h2>0.3 Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PROJECT_DIR</span> <span class="o">=</span> <span class="n">set_root</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">path_assets</span> <span class="o">=</span> <span class="n">PROJECT_DIR</span> <span class="o">/</span> <span class="s2">&quot;assets&quot;</span>
<span class="n">ext_type_fig</span> <span class="o">=</span> <span class="s2">&quot;png&quot;</span>

<span class="n">_fig_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="n">ext_type_fig</span><span class="p">,</span>
    <span class="s2">&quot;dpi&quot;</span><span class="p">:</span> <span class="mi">400</span>
<span class="p">}</span>

<span class="n">n_seed</span> <span class="o">=</span> <span class="mi">2024</span>
<span class="n">n_seed_atv4</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">n_seed_pfi</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_repeats</span> <span class="o">=</span> <span class="mi">30</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;feature_names&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;label&quot;</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">content</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">content</span><span class="p">[</span><span class="s2">&quot;feature_names&quot;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;load_breast_cancer&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;holdout&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;test_size&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="mi">2024</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">black_box</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
    <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">white_box</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dt1&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
    <span class="s2">&quot;dt2&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
    <span class="s2">&quot;dt3&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">black_box</span> <span class="o">=</span> <span class="p">{</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="n">SVC</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">}</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">white_box</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="s2">&quot;dt1&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="s2">&quot;dt2&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;dt3&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">}</span>

<span class="ne">NameError</span>: name &#39;RandomForestClassifier&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span>
    <span class="p">),</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(),</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span>
        <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span>
    <span class="p">),</span>
    <span class="s2">&quot;nb&quot;</span><span class="p">:</span> <span class="n">GaussianNB</span><span class="p">(),</span>
    <span class="s2">&quot;knn&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>         <span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>         <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;entropy&#39;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(),</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="s2">&quot;nb&quot;</span><span class="p">:</span> <span class="n">GaussianNB</span><span class="p">(),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="s2">&quot;knn&quot;</span><span class="p">:</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">}</span>

<span class="ne">NameError</span>: name &#39;DecisionTreeClassifier&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="s2">&quot;DecisionTreeClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;lr&quot;</span><span class="p">:</span> <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">,</span>
    <span class="s2">&quot;knn&quot;</span><span class="p">:</span> <span class="s2">&quot;KNeighborsClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nb&quot;</span><span class="p">:</span> <span class="s2">&quot;NaiveBayes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="s2">&quot;SVC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt1&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt2&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt3&quot;</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=3&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">which_metrics</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Acc&quot;</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">,</span>
    <span class="s2">&quot;Prec&quot;</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">,</span>
    <span class="s2">&quot;Rec&quot;</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">,</span>
    <span class="s2">&quot;F1&quot;</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">,</span>
    <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="n">roc_auc_score</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">which_metrics</span> <span class="o">=</span> <span class="p">{</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="s2">&quot;Acc&quot;</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;Prec&quot;</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;Rec&quot;</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="s2">&quot;F1&quot;</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="s2">&quot;AUC&quot;</span><span class="p">:</span> <span class="n">roc_auc_score</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">}</span>

<span class="ne">NameError</span>: name &#39;accuracy_score&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tick_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;axis&quot;</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="s2">&quot;which&quot;</span><span class="p">:</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="s2">&quot;bottom&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;right&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;labelbottom&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;labelleft&quot;</span><span class="p">:</span> <span class="kc">False</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lower_color_name</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">upper_color_name</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="selecao-de-modelos">
<h1>1. Seleção de modelos<a class="headerlink" href="#selecao-de-modelos" title="Link to this heading">#</a></h1>
<p>Durante essa seção, será aplicado  um conjunto de algoritmos supervisionados, com o intuito de classificar corretamente o tipo do cancer de um individuo, se é Maligno (0) ou Benigno (1). Será treinado um conjunto de algoritmos, utilizando inicialmente o método do <em>holdout</em>, selecionando o melhor modelo, além de exibir inicialmente uma arvore compacta de 2 níveis.</p>
<section id="modelos-e-metricas">
<h2>1.1 Modelos e métricas<a class="headerlink" href="#modelos-e-metricas" title="Link to this heading">#</a></h2>
<p>Durante o decorrer da atividade, será aplicado métodos supervisionados, sendo eles:</p>
<ul class="simple">
<li><p><em>Decision Tree</em>;</p></li>
<li><p><em>Random Forest</em>.</p></li>
<li><p><em>Regressão Logística</em>;</p></li>
<li><p><em>Naive Bayes</em>;</p></li>
<li><p><em>kNN</em>.</p></li>
</ul>
<p>Algumas métricas serão obtidas ao decorrer do experimento, sendo elas:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span> <span class="c1"># matriz de confusão para visualização dos outputs</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span> <span class="c1"># acuracia</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span> <span class="c1"># precisão</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">recall_score</span> <span class="c1"># recall</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span> <span class="c1"># f1-score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span> <span class="c1"># curva roc</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span> <span class="c1"># curva da precisão versus recall</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">auc</span> <span class="c1"># valor da area sob a curva</span>
</pre></div>
</div>
</section>
<section id="preparando-dataset">
<h2>1.2 Preparando dataset<a class="headerlink" href="#preparando-dataset" title="Link to this heading">#</a></h2>
<section id="process-dataset">
<h3>1.2.1 Process dataset<a class="headerlink" href="#process-dataset" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">content</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">features</span>
<span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">data</span>
    <span class="o">.</span><span class="n">columns</span>
    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">content</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">columns</span><span class="o">=</span><span class="n">features</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">data</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="o">.</span><span class="n">columns</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="split">
<h3>1.2.2 Split<a class="headerlink" href="#split" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="ne">NameError</span>: name &#39;data&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="holdout">
<h3>1.2.3 Holdout<a class="headerlink" href="#holdout" title="Link to this heading">#</a></h3>
<p>aplicação do processo de holdout, considerando um tamanho de teste de <code class="docutils literal notranslate"><span class="pre">30%</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;holdout&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;holdout&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;train_test_split&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="modelagem">
<h2>1.3 Modelagem<a class="headerlink" href="#modelagem" title="Link to this heading">#</a></h2>
<section id="fit">
<h3>1.3.1 Fit<a class="headerlink" href="#fit" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;y_true&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
        <span class="s2">&quot;y_pred&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">preds</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>         <span class="s2">&quot;y_true&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>         <span class="s2">&quot;y_pred&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="p">}</span>

<span class="ne">NameError</span>: name &#39;models&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="metrics">
<h3>1.3.2 Metrics<a class="headerlink" href="#metrics" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">which_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">which_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;Acc&quot;</span><span class="p">:</span>
            <span class="n">metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="p">(</span><span class="o">**</span><span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="s2">&quot;Acc&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="s2">&quot;AUPR&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="s2">&quot;AUC&quot;</span><span class="p">):</span>
            <span class="n">metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="p">(</span><span class="o">**</span><span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;AUC&quot;</span><span class="p">:</span>
            <span class="n">metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">roc_auc_score</span><span class="p">(</span>
                    <span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;y_true&quot;</span><span class="p">],</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;AUPR&quot;</span><span class="p">:</span>
            <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">thresholds</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span>
                <span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;y_true&quot;</span><span class="p">],</span>
                <span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">pos_label</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span>
            <span class="p">)</span>
            <span class="n">metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">auc</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">))</span>
    <span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">[</span><span class="n">m</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">which_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">which_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="overview">
<h3>1.3.3 Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">metrics</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">_names</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

<span class="ne">NameError</span>: name &#39;metrics&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_hm</span><span class="p">,</span> <span class="n">axes_hm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.3f&quot;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes_hm</span><span class="p">)</span>
<span class="n">axes_hm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Heatmap&#39;</span><span class="p">)</span>
<span class="n">axes_hm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Métricas&#39;</span><span class="p">)</span>
<span class="n">axes_hm</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Modelos&#39;</span><span class="p">)</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-01_heatmap_metrics.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_hm</span><span class="p">,</span> <span class="n">axes_hm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.3f&quot;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes_hm</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">axes_hm</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Heatmap&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">axes_hm</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Métricas&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;sns&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/f7afe09a0efc7cfb82d1b3d4768e9364625fbcb3cbb714a1cfd1332eb393d351.png" src="../../_images/f7afe09a0efc7cfb82d1b3d4768e9364625fbcb3cbb714a1cfd1332eb393d351.png" />
</div>
</div>
<p>Podemos notar que o modelo <em>Random Forest Classifier</em> apresentou, em geral, melhores métricas, com exceção do recall, aonde o <em>KNN</em> se destacou com um valor de <code class="docutils literal notranslate"><span class="pre">0.981</span></code>.</p>
</section>
<section id="matriz-de-confusao">
<h3>1.3.4 Matriz de confusão<a class="headerlink" href="#matriz-de-confusao" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_col</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">n_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">//</span> <span class="n">n_col</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">n_row</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">//</span> <span class="n">n_col</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">n_col</span> <span class="o">=</span> <span class="mi">2</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">n_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">//</span> <span class="n">n_col</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">else</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;models&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_cm</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axes</span><span class="p">)):</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">preds</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;y_pred&quot;</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="n">models</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">cm</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">_names</span><span class="p">[</span><span class="n">name</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted label&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True label&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">fig_cm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_cm</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-01_heatmap_cm.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_cm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_cm</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axes</span><span class="p">)):</span>

<span class="ne">NameError</span>: name &#39;n_row&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Ao olharmos apenas para a classe positiva, o modelo que mais se destacou foi o <em>KNN</em> contudo apresentou maiores valores de falso positivo. Em termos gerais e quanto a balanceamento geral das classificações, o modelo <em>Random Forest</em> se destacou novamente ao olharmos diretamente para a matriz de confusão.</p>
</section>
<section id="arvore-compacta">
<h3>1.3.5 Arvore compacta<a class="headerlink" href="#arvore-compacta" title="Link to this heading">#</a></h3>
<p>Como os modelos ja foram treinados, podemos obter a arvore compacta mais facilmente.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_dt</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plot_tree</span><span class="p">(</span>
    <span class="n">models</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">],</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
    <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">],</span>
    <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes</span>
<span class="p">)</span>
<span class="n">fig_dt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_dt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-01_dt.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_dt</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">plot_tree</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">models</span><span class="p">[</span><span class="s2">&quot;dt&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">feature_names</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s2">&quot;positive&quot;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">ax</span><span class="o">=</span><span class="n">axes</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">fig_dt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">fig_dt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-01_dt.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_tree&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/e92642c3b8eead051189eb88ae24258645a60c123a30ce09d8eebcfecde73893.png" src="../../_images/e92642c3b8eead051189eb88ae24258645a60c123a30ce09d8eebcfecde73893.png" />
</div>
</div>
<p>Ao olharmos a arvore compacta, podemos notar que a variável *Worst Perimeter é bem impactante na hora de separação entre as classes positivas das negativas. Em segundo nivel, podemos notar que a variavel <em>Worst Concave Points</em>, ao olhar para a classe positiva, é possivel notalr um baixo grau de entropia, conseguindo ser usada de forma significante para separar a classe das demais.</p>
</section>
<section id="curva-roc">
<h3>1.3.6 Curva ROC<a class="headerlink" href="#curva-roc" title="Link to this heading">#</a></h3>
<p>Ao olharmos a arvore compacta, podemos notar que a variável *Worst Perimeter é bem impactante na hora de separação entre as classes positivas das negativas. Em segundo nivel, podemos notar que a variavel <em>Worst Concave Points</em>, ao olhar para a classe positiva, é possivel notalr um baixo grau de entropia, conseguindo ser usada de forma significante para separar a classe das demais.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_roc</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Curva ROC&quot;</span><span class="p">)</span>
<span class="n">fig_roc</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_roc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-01_roc-auc.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_roc</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">RocCurveDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">axes</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;models&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/d7b549fae050e19893f7b95cb0035ab6c44df7466ca3501ed7878e5c8cc4c60e.png" src="../../_images/d7b549fae050e19893f7b95cb0035ab6c44df7466ca3501ed7878e5c8cc4c60e.png" />
</div>
</div>
</section>
</section>
<section id="cross-validation">
<h2>1.4 Cross-validation<a class="headerlink" href="#cross-validation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_folds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">cv_scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">cv_scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;roc_auc&quot;</span><span class="p">]:</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">num_folds</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">cv_scores</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">num_folds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">cv_scores</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">cv_scores</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="s2">&quot;recall&quot;</span><span class="p">,</span> <span class="s2">&quot;precision&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;roc_auc&quot;</span><span class="p">]:</span>

<span class="ne">NameError</span>: name &#39;tqdm&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
<span class="n">cv_results</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">cv_results</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">_names</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="conclusoes">
<h2>1.5 Conclusões<a class="headerlink" href="#conclusoes" title="Link to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><strong>DecisionTreeClassifier</strong></p></th>
<th class="head"><p><strong>RandomForestClassifier</strong></p></th>
<th class="head"><p><strong>LogisticRegression</strong></p></th>
<th class="head"><p><strong>NaiveBayes</strong></p></th>
<th class="head"><p><strong>KNeighborsClassifier</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>accuracy</strong></p></td>
<td><p>0.892857</p></td>
<td><p>0.963127</p></td>
<td><p>0.950815</p></td>
<td><p>0.936779</p></td>
<td><p>0.926190</p></td>
</tr>
<tr class="row-odd"><td><p><strong>recall</strong></p></td>
<td><p>0.927302</p></td>
<td><p>0.980317</p></td>
<td><p>0.972143</p></td>
<td><p>0.966270</p></td>
<td><p>0.958016</p></td>
</tr>
<tr class="row-even"><td><p><strong>precision</strong></p></td>
<td><p>0.911139</p></td>
<td><p>0.965268</p></td>
<td><p>0.952119</p></td>
<td><p>0.935949</p></td>
<td><p>0.928438</p></td>
</tr>
<tr class="row-odd"><td><p><strong>f1</strong></p></td>
<td><p>0.915994</p></td>
<td><p>0.974951</p></td>
<td><p>0.961436</p></td>
<td><p>0.950494</p></td>
<td><p>0.942189</p></td>
</tr>
<tr class="row-even"><td><p><strong>roc_auc</strong></p></td>
<td><p>0.963724</p></td>
<td><p>0.991792</p></td>
<td><p>0.993387</p></td>
<td><p>0.988441</p></td>
<td><p>0.950248</p></td>
</tr>
</tbody>
</table>
<p>Por fim, ao analisarmos apenas a área sob a <em>Curva ROC</em> (4.), podemos notar que existe um empate entre os modelos <em>Random Forest, Logistic Regression</em> e <em>GaussianNB (Naive Bayes considerando a verossimilhanca seguindo uma Gaussiana)</em>, empate técnico quando olhamos o gráfico acima, mas ao olharmos a seção (2.3) do material, é possivel notar o destaque do <em>Random Forest</em>.</p>
<p>Ao compararmos as métricas anteriores, o modelo mais balanceado em termos gerais das métricas, é o <em>Random Forest</em>, lembrando o <em>heatmap</em> da seção (2.3), o modelo desempenhou superiormente com respeito as outras métricas, ainda que em geral, os modelos desempenharam de forma bem semelhante para o cenário do conjunto de dados <em>Breast Cancer</em>.</p>
<p>Por fim, ao olharmos para os resultados apos a validação cruzada, considerando um numero de folds de 10, podemos notar que o em termos de generalização, o modelo Random Forest apresentou os melhores resultados.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="surrogates">
<h1>2. Surrogates<a class="headerlink" href="#surrogates" title="Link to this heading">#</a></h1>
<p>Nesta seção será utilizado o método de <em>Global surrogate</em>, aonde iremos utilizar um model caixa branca <em>Decision Tree</em>, variando a profundidade da arvore entre 1 e 3, com o intuito de analisar a aproximação com o modelo caixa preta; e para modelo caixa preta, serão considerados o <em>Random Forest</em> e o <em>SVC</em>.</p>
<section id="id1">
<h2>2.1 Modelagem<a class="headerlink" href="#id1" title="Link to this heading">#</a></h2>
<section id="fit-black-box-and-white-box-sem-aplicar-pca">
<h3>2.1.1 Fit <em>black-box</em> and <em>white-box</em> (sem aplicar PCA)<a class="headerlink" href="#fit-black-box-and-white-box-sem-aplicar-pca" title="Link to this heading">#</a></h3>
<p>Será treinado o modelo sem aplicar o PCA, para ser possivel uma interpretação direta das variaveis apartir do <em>white-box</em> ao final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">add_pca</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">add_pca</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;add_pca&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">white_box_models</span><span class="p">,</span> <span class="n">black_box_models</span><span class="p">,</span> <span class="n">white_yhat</span><span class="p">,</span> <span class="n">black_yhat</span> <span class="o">=</span> <span class="n">train_surrogates</span><span class="p">(</span>
    <span class="n">white_box</span><span class="p">,</span>
    <span class="n">black_box</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">,</span>
    <span class="n">y_train</span><span class="p">,</span>
    <span class="n">X_test</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">white_box_models</span><span class="p">,</span> <span class="n">black_box_models</span><span class="p">,</span> <span class="n">white_yhat</span><span class="p">,</span> <span class="n">black_yhat</span> <span class="o">=</span> <span class="n">train_surrogates</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">white_box</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">black_box</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">X_train</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">y_train</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">X_test</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;train_surrogates&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="aplicando-pca">
<h3>2.1.2 Aplicando <em>PCA</em><a class="headerlink" href="#aplicando-pca" title="Link to this heading">#</a></h3>
<p>Será aplicado o método do <em>PCA</em> aoenas representar os dados em <span class="math notranslate nohighlight">\(\mathbb{R}^{2}\)</span> e a comparação do método <em>black box</em> com o <em>surrogate</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">X_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;PCA&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="graficos">
<h3>2.1.3 Gráficos<a class="headerlink" href="#graficos" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_X</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">_X</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pca&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_bc</span><span class="p">,</span> <span class="n">axes_bc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
    <span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">34</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_bc</span><span class="p">,</span> <span class="n">axes_bc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="nb">len</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;black_yhat&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_dist</span><span class="p">,</span> <span class="n">axes_dist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">axes_dist</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
<span class="p">)</span>
<span class="n">axes_dist</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="n">_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
<span class="p">)</span>
<span class="c1"># Remover os valores dos eixos x e y</span>
<span class="n">axes_dist</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axes_dist</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="c1"># Remover as bordas do gráfico</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">fig_dist</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_dist</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_dist_plot.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span> <span class="o">**</span><span class="n">_fig_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">35</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_dist</span><span class="p">,</span> <span class="n">axes_dist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">axes_dist</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">axes_dist</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">_X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="n">_X</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="c1"># Remover os valores dos eixos x e y</span>

<span class="ne">NameError</span>: name &#39;_X&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/01f57e78a7be6a713ab5b0c20caf2cd4a24c28c1bcfa26c0a2374c65be05901a.png" src="../../_images/01f57e78a7be6a713ab5b0c20caf2cd4a24c28c1bcfa26c0a2374c65be05901a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">axes_bc</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">):</span>
    <span class="n">axes_bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes_bc</span><span class="p">])</span>
<span class="k">for</span> <span class="n">bidx</span><span class="p">,</span> <span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">b_yhat</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
    <span class="p">)</span>
    <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">b_yhat</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">widx</span><span class="p">,</span> <span class="p">(</span><span class="n">w_name</span><span class="p">,</span> <span class="n">w_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">white_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;bs&quot;</span>
        <span class="p">)</span>
        <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_pca</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;g^&quot;</span>
        <span class="p">)</span>
        <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Surrogate: $</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;_{acc=&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">b_yhat</span><span class="p">,</span><span class="w"> </span><span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">]),</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;}$&quot;</span>
        <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="n">widx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="o">**</span><span class="n">tick_params</span><span class="p">)</span>
    <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_2$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bidx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="p">:]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$x_1$&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">axes_bc</span><span class="p">[</span><span class="n">bidx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Black box: </span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">b_name</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">fig_bc</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_bc</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_bc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">if</span> <span class="n">axes_bc</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">axes_bc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">axes_bc</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">for</span> <span class="n">bidx</span><span class="p">,</span> <span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">b_yhat</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">black_yhat</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>

<span class="ne">NameError</span>: name &#39;axes_bc&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h3>2.1.4 Overview<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Acima, temos os gráficos em <span class="math notranslate nohighlight">\(\mathbb{R}^{2}\)</span> do conjunto de dados sob o connjunto de teste colorido por seus respectivos labels. A primeira linha de gráficos trata-se do modelo <em>Random Forest</em> e as colunas são os modelos <em>white box</em>, e os labels classificados, auemntando a profundidade da arvore, aonde o intuito é aproximar o comportamento do modelo caixa preta; além disso, foi adicionado em subescrito a acuracia referente as classificações obtidas pelo respectivo modelo <em>white box</em> versus o verdadeiro obtido pelo modelo <em>black box</em>.</p>
<p>Para a primeira linha, é possível notar que para uma profundidade de 2 niveis, podemos ja replicar com tranquilidade o modelo caixa preta, sem perdermos resultados para esse conjutno de dados, e tambem diminuindo complexidade no modelo final. Já para o <em>SVC</em> já é possível ver que a arvore de decisão já consegui replicar com tranquilidade o modelo caixa preta, considerando apenas 1 nivel de profundidade.</p>
</section>
</section>
<section id="arvore-de-decisao">
<h2>2.2 Arvore de decisão<a class="headerlink" href="#arvore-de-decisao" title="Link to this heading">#</a></h2>
<section id="ambos-modelos-black-box">
<h3>2.2.1 Ambos modelos <em>black box</em><a class="headerlink" href="#ambos-modelos-black-box" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_tree</span><span class="p">,</span> <span class="n">axes_tree</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">black_box</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">37</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_tree</span><span class="p">,</span> <span class="n">axes_tree</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">black_box</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;black_box&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes_tree</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
    <span class="n">axes_tree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">axes_tree</span><span class="p">]])</span>
<span class="k">elif</span> <span class="n">axes_tree</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">axes_tree</span> <span class="o">=</span> <span class="n">axes_tree</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes_tree</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">axes_tree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">axes_tree</span><span class="p">]])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">elif</span> <span class="n">axes_tree</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

<span class="ne">NameError</span>: name &#39;axes_tree&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">b_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">b_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">black_box</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">w_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">w_name</span><span class="p">,</span> <span class="n">w_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">plot_tree</span><span class="p">(</span>
            <span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">],</span>
            <span class="n">feature_names</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
            <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;no&#39;</span><span class="p">,</span> <span class="s2">&quot;yes&quot;</span><span class="p">],</span>
            <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">axes_tree</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span> <span class="n">w_idx</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">axes_tree</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span> <span class="n">w_idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">_names</span><span class="p">[</span><span class="n">w_name</span><span class="p">]</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">fig_tree</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_tree</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_dt_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_tree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">for</span> <span class="n">b_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">b_name</span><span class="p">,</span> <span class="n">b_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">black_box</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="k">for</span> <span class="n">w_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">w_name</span><span class="p">,</span> <span class="n">w_model</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">white_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>         <span class="n">plot_tree</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>             <span class="n">w_model</span><span class="p">[</span><span class="n">b_name</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>             <span class="n">feature_names</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>             <span class="n">ax</span><span class="o">=</span><span class="n">axes_tree</span><span class="p">[</span><span class="n">b_idx</span><span class="p">,</span> <span class="n">w_idx</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;black_box&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Acima podemos ver os nós das arvores para cada modelo caixa preta, sendo respectivamente o <em>Random Forest</em> e o <em>SVC</em> respectivamente. É possivel notar para o <em>SVC</em>, que a arvore de decisão apresentou um impureza nula, para ambas as classes, para apenas 1 nivel de profundidade, e para o <em>Random Forest</em>, bastou apenas 2 níveis.</p>
</section>
</section>
<section id="superficie-de-separacao">
<h2>2.3 Superficie de separação<a class="headerlink" href="#superficie-de-separacao" title="Link to this heading">#</a></h2>
<p>Nesta seção, vamos gerar um conjunto de dados sintetico clássico (<em>Noisy Circles</em>), treinar um modelo <em>black box</em> e <em>white box</em>. Apos o treinamento, vamos gerar um numero maior de instancias apartir de uma uniforme definida entre 0 e 1 para poder comparar a superficie de separação o <em>surrogate</em> e o <em>black box</em>.</p>
<section id="aproximando-o-white-box">
<h3>2.3.1 Aproximando o <em>white box</em><a class="headerlink" href="#aproximando-o-white-box" title="Link to this heading">#</a></h3>
<p>No experimento abaixo, vamos adicionar mais arvores de decisoes, aumentando o numero de profundidade, com o intuito de simular ainda mais proximo o resultado do modelo caixa preta.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_samples_train</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">n_samples_test</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">train_seed</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">test_seed</span> <span class="o">=</span> <span class="mi">31</span>
<span class="n">_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;factor&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
    <span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="mf">0.05</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">white_box</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">f</span><span class="s2">&quot;dt</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="s2">&quot;DecisionTreeClassifier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="s2">&quot;SVC&quot;</span>
<span class="p">}</span>
<span class="n">_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
    <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;dt</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">fr</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">6</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">white_box</span> <span class="o">=</span> <span class="p">{</span>
<span class="nn">      3     f&quot;dt{i}&quot;: DecisionTreeClassifier(max_depth=i, random_state=n_seed) for i</span> in <span class="ni">range</span><span class="nt">(1, max_depth + 1)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">}</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">_names</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="s2">&quot;DecisionTreeClassifier&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="s2">&quot;SVC&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;dt</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">fr</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="nn">Cell In[41], line 3,</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">white_box</span> <span class="o">=</span> <span class="p">{</span>
<span class="nn">----&gt; 3     f&quot;dt{i}&quot;: DecisionTreeClassifier(max_depth=i, random_state=n_seed) for i</span> in <span class="ni">range</span><span class="nt">(1, max_depth + 1)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">}</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">_names</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="s2">&quot;dt&quot;</span><span class="p">:</span> <span class="s2">&quot;DecisionTreeClassifier&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="s2">&quot;svc&quot;</span><span class="p">:</span> <span class="s2">&quot;SVC&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;dt</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="sa">fr</span><span class="s2">&quot;DecisionTreeClassifier\_max-depth=</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;DecisionTreeClassifier&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="n">train_seed</span><span class="p">,</span> <span class="s2">&quot;n_samples&quot;</span><span class="p">:</span> <span class="n">n_samples_train</span><span class="p">},</span>
    <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;random_state&quot;</span><span class="p">:</span> <span class="n">test_seed</span><span class="p">,</span> <span class="s2">&quot;n_samples&quot;</span><span class="p">:</span> <span class="n">n_samples_test</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span>
<span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_noisy_circles</span><span class="p">,</span> <span class="n">train_nc_labels</span> <span class="o">=</span> <span class="n">make_circles</span><span class="p">(</span>
    <span class="o">**</span><span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">test_noisy_circles</span><span class="p">,</span> <span class="n">test_nc_labels</span> <span class="o">=</span> <span class="n">make_circles</span><span class="p">(</span>
    <span class="o">**</span><span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">train_noisy_circles</span><span class="p">,</span> <span class="n">train_nc_labels</span> <span class="o">=</span> <span class="n">make_circles</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="o">**</span><span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;train&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">test_noisy_circles</span><span class="p">,</span> <span class="n">test_nc_labels</span> <span class="o">=</span> <span class="n">make_circles</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="o">**</span><span class="n">noise_params</span><span class="p">[</span><span class="s2">&quot;test&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;make_circles&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">##################################################</span>
<span class="c1"># Nesse trecho, é treinado os modelos sorragates</span>
<span class="c1">##################################################</span>
<span class="n">white_box_models</span><span class="p">,</span> <span class="n">black_box_models</span><span class="p">,</span> <span class="n">white_yhat</span><span class="p">,</span> <span class="n">black_yhat</span> <span class="o">=</span> <span class="n">train_surrogates</span><span class="p">(</span>
    <span class="n">white_box</span><span class="p">,</span>
    <span class="n">black_box</span><span class="p">,</span>
    <span class="n">train_noisy_circles</span><span class="p">,</span>
    <span class="n">train_nc_labels</span><span class="p">,</span>
    <span class="n">test_noisy_circles</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">44</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">##################################################</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># Nesse trecho, é treinado os modelos sorragates</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">##################################################</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">white_box_models</span><span class="p">,</span> <span class="n">black_box_models</span><span class="p">,</span> <span class="n">white_yhat</span><span class="p">,</span> <span class="n">black_yhat</span> <span class="o">=</span> <span class="n">train_surrogates</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">white_box</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">black_box</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">train_noisy_circles</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">train_nc_labels</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">test_noisy_circles</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;train_surrogates&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_circles</span><span class="p">,</span> <span class="n">axes_circles</span> <span class="o">=</span> <span class="n">plot_results</span><span class="p">(</span>
    <span class="n">black_yhat</span><span class="p">,</span>
    <span class="n">white_yhat</span><span class="p">,</span>
    <span class="n">test_noisy_circles</span><span class="p">,</span>
    <span class="n">tick_params</span><span class="p">,</span>
    <span class="n">_names</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">fig_circles</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_circles</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_circles_dt_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_circles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">45</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_circles</span><span class="p">,</span> <span class="n">axes_circles</span> <span class="o">=</span> <span class="n">plot_results</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">black_yhat</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">white_yhat</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">test_noisy_circles</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">tick_params</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">_names</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">fig_circles</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">fig_circles</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_circles_dt_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_results&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="aumentando-o-numero-de-dados">
<h3>2.3.2 Aumentando o número de dados<a class="headerlink" href="#aumentando-o-numero-de-dados" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">xy_min</span> <span class="o">=</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xy_max</span> <span class="o">=</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">46</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">xy_min</span> <span class="o">=</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">xy_max</span> <span class="o">=</span> <span class="n">train_noisy_circles</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;train_noisy_circles&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
    <span class="n">low</span><span class="o">=</span><span class="n">xy_min</span><span class="p">,</span>
    <span class="n">high</span><span class="o">=</span><span class="n">xy_max</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">X_simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">low</span><span class="o">=</span><span class="n">xy_min</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">high</span><span class="o">=</span><span class="n">xy_max</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;xy_min&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="predicoes">
<h3>2.3.3 Predições<a class="headerlink" href="#predicoes" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bs_yhat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">bs_name</span><span class="p">,</span> <span class="n">bs_model</span> <span class="ow">in</span> <span class="n">black_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">bs_yhat</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_simulated</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">bs_yhat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">for</span> <span class="n">bs_name</span><span class="p">,</span> <span class="n">bs_model</span> <span class="ow">in</span> <span class="n">black_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">bs_yhat</span><span class="p">[</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_simulated</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;black_box_models&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ws_yhat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ws_name</span><span class="p">,</span> <span class="n">ws_model</span> <span class="ow">in</span> <span class="n">white_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ws_yhat</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bs_name</span><span class="p">,</span> <span class="n">bs_model</span> <span class="ow">in</span> <span class="n">ws_model</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ws_yhat</span><span class="p">[</span><span class="n">ws_name</span><span class="p">][</span><span class="n">bs_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">bs_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_simulated</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">ws_yhat</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">for</span> <span class="n">ws_name</span><span class="p">,</span> <span class="n">ws_model</span> <span class="ow">in</span> <span class="n">white_box_models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">ws_yhat</span><span class="p">[</span><span class="n">ws_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="k">for</span> <span class="n">bs_name</span><span class="p">,</span> <span class="n">bs_model</span> <span class="ow">in</span> <span class="n">ws_model</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

<span class="ne">NameError</span>: name &#39;white_box_models&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot">
<h3>2.3.4 Plot<a class="headerlink" href="#plot" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bs_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ws_yhat</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/matplotlib/pyplot.py:1614,</span> in <span class="ni">subplots</span><span class="nt">(nrows, ncols, sharex, sharey, squeeze, width_ratios, height_ratios, subplot_kw, gridspec_kw, **fig_kw)</span>
<span class="g g-Whitespace">   </span><span class="mi">1470</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1471</span><span class="sd"> Create a figure and a set of subplots.</span>
<span class="g g-Whitespace">   </span><span class="mi">1472</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1611</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1612</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1613</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="o">**</span><span class="n">fig_kw</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1614</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1615</span>                    <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1616</span>                    <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gridspec_kw</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="n">height_ratios</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>                    <span class="n">width_ratios</span><span class="o">=</span><span class="n">width_ratios</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1618</span> <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/matplotlib/figure.py:930,</span> in <span class="ni">FigureBase.subplots</span><span class="nt">(self, nrows, ncols, sharex, sharey, squeeze, width_ratios, height_ratios, subplot_kw, gridspec_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;width_ratios&#39; must not be defined both as &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">927</span>                          <span class="s2">&quot;parameter and as key in &#39;gridspec_kw&#39;&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">928</span>     <span class="n">gridspec_kw</span><span class="p">[</span><span class="s1">&#39;width_ratios&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width_ratios</span>
<span class="ne">--&gt; </span><span class="mi">930</span> <span class="n">gs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">gridspec_kw</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">931</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="n">squeeze</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">932</span>                   <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">933</span> <span class="k">return</span> <span class="n">axs</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/matplotlib/figure.py:1542,</span> in <span class="ni">FigureBase.add_gridspec</span><span class="nt">(self, nrows, ncols, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1503</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1504</span><span class="sd"> Return a `.GridSpec` that has this figure as a parent.  This allows</span>
<span class="g g-Whitespace">   </span><span class="mi">1505</span><span class="sd"> complex layout of Axes in the figure.</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">   </span><span class="mi">1538</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">1539</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1541</span> <span class="n">_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># pop in case user has added this...</span>
<span class="ne">-&gt; </span><span class="mi">1542</span> <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1543</span> <span class="k">return</span> <span class="n">gs</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/matplotlib/gridspec.py:378,</span> in <span class="ni">GridSpec.__init__</span><span class="nt">(self, nrows, ncols, figure, left, bottom, right, top, wspace, hspace, width_ratios, height_ratios)</span>
<span class="g g-Whitespace">    </span><span class="mi">375</span> <span class="bp">self</span><span class="o">.</span><span class="n">hspace</span> <span class="o">=</span> <span class="n">hspace</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">figure</span>
<span class="ne">--&gt; </span><span class="mi">378</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span>                  <span class="n">width_ratios</span><span class="o">=</span><span class="n">width_ratios</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>                  <span class="n">height_ratios</span><span class="o">=</span><span class="n">height_ratios</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.19/x64/lib/python3.9/site-packages/matplotlib/gridspec.py:48,</span> in <span class="ni">GridSpecBase.__init__</span><span class="nt">(self, nrows, ncols, height_ratios, width_ratios)</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span><span class="sd"> Parameters</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span><span class="sd"> ----------</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span><span class="sd">     If not given, all rows will have the same height.</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">Integral</span><span class="p">)</span> <span class="ow">or</span> <span class="n">nrows</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">48</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>         <span class="sa">f</span><span class="s2">&quot;Number of rows must be a positive integer, not </span><span class="si">{</span><span class="n">nrows</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ncols</span><span class="p">,</span> <span class="n">Integral</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ncols</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="sa">f</span><span class="s2">&quot;Number of columns must be a positive integer, not </span><span class="si">{</span><span class="n">ncols</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: Number of rows must be a positive integer, not 0
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 1200x600 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_simu</span><span class="p">,</span> <span class="n">axes_simu</span> <span class="o">=</span> <span class="n">plot_simulation_results</span><span class="p">(</span>
    <span class="n">bs_yhat</span><span class="p">,</span>
    <span class="n">ws_yhat</span><span class="p">,</span>
    <span class="n">X_simulated</span><span class="p">,</span>
    <span class="n">tick_params</span><span class="p">,</span>
    <span class="n">_names</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">fig_simu</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_simu</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_uniform_dt_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_simu</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">51</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_simu</span><span class="p">,</span> <span class="n">axes_simu</span> <span class="o">=</span> <span class="n">plot_simulation_results</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">bs_yhat</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">ws_yhat</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">X_simulated</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">tick_params</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">_names</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">fig_simu</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">fig_simu</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-03_uniform_dt_surrogates.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_simulation_results&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Podemos notar que o <em>Random Forest</em> sob  o conjunto uniformemente distribuido, identificou um grupo em formato de cubo inscrito dentro do cubo maior e o <em>SVC</em> similar, contudo circunscrito no quadrado maior. Ao olhar para os modelos caixa branca, é possivel notar o “trajeto” que o modelo levou para identificar o quadrado interno como o segundo grupo para o Random Forest, e conseguiu se aproximar significantemente do resultado do modelo caixa preta. Já analisando o <em>SVC</em>, ele conseguiu identificar o subgrupo mas nao conseguiu definir o formato dele, possivelmente pela diferença entre as naturezas dos algoritmos, aonde o <em>SVC</em> busca traçar um hiperplano que consiga dividar as caracteristicas dos grupos diferente da Arvore de decisãp,  que busca subdividar os dados em subconjuntos homogeneos.</p>
</section>
</section>
<section id="id3">
<h2>2.4 Conclusões<a class="headerlink" href="#id3" title="Link to this heading">#</a></h2>
<p>Para o problema do breast cancer, foi aplicado dois modelos de caixa preta, <em>SVC</em> e o <em>Random Forest</em>, e para o modelo caixa branca, foi aplicado variações de profundidade de Arvores de Decisão. Ao decorrer da atividade, é possivel notar o quão interessante é método de <em>Surrogates</em>, aonde é possivel reduzir bastante o custo computacional, uma vez que é possivel aproximar modelos caixa preta  por meio de métodos além de ser mais interpretaveis, menos custosos.</p>
<p>Além de ser menos custoso, o método nos proporciona a possibilidade de, por meio de métodos interpretaveis, aproximar como o modelo caixa preta tomou certas decisões para determinada classificação de uma instância.</p>
<p>Ao olhar a subseção <code class="docutils literal notranslate"><span class="pre">2.2.1</span></code>, é possível notar que apartir de uma profundidade de 2 dois nós, o método caixa branca conseguiu estimar bem o comportamento do modelo caixa preta, considerando as variáveis <em>worst concave points</em> e <em>worst perimeter</em> mais decisorias e importantes para a separação dos tipos de cancer, respectivamente.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="feature-importances">
<h1>3. Feature Importances<a class="headerlink" href="#feature-importances" title="Link to this heading">#</a></h1>
<p>Durante esta seção  iremos justar um modelo para a base de dados <em>breast cancer</em>, avaliar seu desempenho por meio do método de Cross Validation e verificar o <em>Feature Importance</em> por classe, utiliznado o método <em>Permutation Feature Importance</em>.</p>
<section id="id4">
<h2>3.1 Modelagem<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<section id="id5">
<h3>3.1.1 Fit<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_atv4</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">52</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_atv4</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;RandomForestClassifier&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="avaliando">
<h3>3.1.2 Avaliando<a class="headerlink" href="#avaliando" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">full_model_metrics</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">which_metrics</span><span class="o">=</span><span class="n">which_metrics</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
<span class="n">full_model_metrics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">full_model_metrics</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">which_metrics</span><span class="o">=</span><span class="n">which_metrics</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">full_model_metrics</span>

<span class="ne">NameError</span>: name &#39;calculate_metrics&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="permutation-feature-importance-pfi">
<h2>3.2 Permutation Feature Importance (PFI)<a class="headerlink" href="#permutation-feature-importance-pfi" title="Link to this heading">#</a></h2>
<section id="full-model">
<h3>3.2.1 Full model<a class="headerlink" href="#full-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">X_test</span><span class="p">,</span>
    <span class="n">y_test</span><span class="p">,</span>
    <span class="n">n_repeats</span><span class="o">=</span><span class="n">n_repeats</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_pfi</span>
<span class="p">)</span>
<span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">importances_mean</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
<span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;importances&quot;</span><span class="p">]</span>
<span class="n">result</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">columns</span>
<span class="n">data_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;features&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importances_mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">54</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">result</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">model</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">X_test</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">y_test</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">n_repeats</span><span class="o">=</span><span class="n">n_repeats</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_pfi</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">importances_mean</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;importances&quot;</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;permutation_importance&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotagem do gráfico de barras</span>
<span class="n">fig_full</span><span class="p">,</span> <span class="n">axes_full</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">data_result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">data_result</span><span class="p">[</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">data_result</span><span class="p">[</span><span class="s1">&#39;importances_std&#39;</span><span class="p">],</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia Média&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Importancia Média das Features&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data_result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig_full</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_full</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-04_feature_importance_full.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">55</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Plotagem do gráfico de barras</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig_full</span><span class="p">,</span> <span class="n">axes_full</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">data_result</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">data_result</span><span class="p">[</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">yerr</span><span class="o">=</span><span class="n">data_result</span><span class="p">[</span><span class="s1">&#39;importances_std&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia Média&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;data_result&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/222d22c5eda51f32220575000b6fd3cb6e5ab78acfff0bdc736a57c072d07fb8.png" src="../../_images/222d22c5eda51f32220575000b6fd3cb6e5ab78acfff0bdc736a57c072d07fb8.png" />
</div>
</div>
</section>
<section id="por-classe">
<h3>3.2.2 Por classe<a class="headerlink" href="#por-classe" title="Link to this heading">#</a></h3>
<p>Abaixo será separado o conjunto de teste pelas classes, para o calculo do <em>PFI</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">class_label</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">)):</span>
    <span class="n">X_test_class</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="n">class_label</span><span class="p">]</span>
    <span class="n">y_test_class</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="n">class_label</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">permutation_importance</span><span class="p">(</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">X_test_class</span><span class="p">,</span>
        <span class="n">y_test_class</span><span class="p">,</span>
        <span class="n">n_repeats</span><span class="o">=</span><span class="n">n_repeats</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_pfi</span>
    <span class="p">)</span>
    <span class="n">sorted_idx</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">importances_mean</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;importances&quot;</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;class_</span><span class="si">{</span><span class="n">class_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">results</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;c</span><span class="si">{</span><span class="n">class_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">])</span>
<span class="n">data_result_class</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">56</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="k">for</span> <span class="n">class_label</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">)):</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">X_test_class</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="n">class_label</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">y_test_class</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">[</span><span class="n">y_test</span> <span class="o">==</span> <span class="n">class_label</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;tqdm&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="analise">
<h3>3.2.3 Analise<a class="headerlink" href="#analise" title="Link to this heading">#</a></h3>
<p>Ao analisar a importância das características no modelo observamos uma variação significativa na <em>importance</em> de cada <em>feature</em> para o modelo. Considerando primeiramente o modelo completo, notamos que algumas <em>features</em> têm uma influência considerável, enquanto outras têm importância praticamente nula. Uma analise interessante seria das <em>features</em>  <em>mean_concavity</em>, <em>mean_concave_points</em> e <em>worst_radius</em> que tiveram uma importância negativa, evidenciando que essas features perturbando aleatoriamente as instancias, apresentaram metricas maiores que o modelo completo. Já olhando para a <em>feature</em> <em>worst_texture</em>, que possui uma importância positiva relativamente alta, indicando uma associação forte para a classificação de uma instância como classe positiva, que seria o cancer benigno.</p>
</section>
</section>
<section id="id6">
<h2>3.3 Gráficos<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<section id="visualizacao">
<h3>3.3.1 Visualização<a class="headerlink" href="#visualizacao" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">num_colors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;y&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">color_sequence</span> <span class="o">=</span> <span class="n">generate_color_range</span><span class="p">(</span>
    <span class="n">lower_color_name</span><span class="p">,</span>
    <span class="n">upper_color_name</span><span class="p">,</span>
    <span class="n">num_colors</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">color_sequence</span> <span class="o">=</span> <span class="n">generate_color_range</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">lower_color_name</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">upper_color_name</span><span class="p">,</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">num_colors</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;num_colors&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">data_result_class</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">ci_mean_importances</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">][</span><span class="s1">&#39;class_0&#39;</span><span class="p">]</span>
<span class="n">ordered_features_full</span> <span class="o">=</span> <span class="n">ci_mean_importances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">data_result_class</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;features&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ci_mean_importances</span> <span class="o">=</span> <span class="n">groups</span><span class="p">[</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">][</span><span class="s1">&#39;class_0&#39;</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ordered_features_full</span> <span class="o">=</span> <span class="n">ci_mean_importances</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;data_result_class&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_hm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_heatmap</span><span class="p">(</span>
    <span class="n">groups</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-04_hm_pfi.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_hm</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_hm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_heatmap</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">groups</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">fig_hm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">fig_hm</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-04_hm_pfi.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_heatmap&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_bar</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_bar_chart</span><span class="p">(</span>
    <span class="n">groups</span><span class="p">,</span>
    <span class="n">ordered_features_full</span><span class="p">,</span>
    <span class="n">color_sequence</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">fig_bar</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_bar</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-04_bar_pfi_byclass.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_bar</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">61</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_bar</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plot_bar_chart</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">groups</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">ordered_features_full</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">color_sequence</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">fig_bar</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">fig_bar</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-04_bar_pfi_byclass.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;plot_bar_chart&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="id7">
<h3>3.3.2 Analise<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>Algumas <em>features</em> apresentaram importância negativa tanto para a classe 0 (câncer maligno) quanto para a classe 1 (câncer benigno). Isso sugere que a essa <em>features</em>, ao serem perturbadas aleatoriamente, apresenta-se um aumento da metrica avaliada pelo <em>PFI</em>.</p>
<p>Além disso, outras <em>features</em> têm importância negativa mais forte para uma das classes em comparação com a outra. Por exemplo, <em>mean_concave_points</em> e <em>worst_concave_points</em> têm importância negativa tanto para a classe 0 quanto para a classe 1, mas apresentam valores mais baixos para a classe 1.</p>
<p>Por fim, podemos observar que algumas <em>features</em> têm importância positiva para uma das classes, sendo ela a <em>feature</em> <em>worst_texture</em> tem importância positiva para a classe 0, o que indica que sua presença está associada a um aumento na probabilidade de classificação da classe positiva. No entanto, essa mesma <em>feature</em> não tem influência direta na classificação da classe 1.</p>
</section>
</section>
<section id="selecionado-features-com-importancia-positiva">
<h2>3.4 Selecionado Features com importancia positiva<a class="headerlink" href="#selecionado-features-com-importancia-positiva" title="Link to this heading">#</a></h2>
<section id="id8">
<h3>3.4.1 Fit<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition</span> <span class="o">=</span> <span class="n">data_result</span><span class="o">.</span><span class="n">importances_mean</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">condition</span> <span class="o">=</span> <span class="n">data_result</span><span class="o">.</span><span class="n">importances_mean</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;data_result&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_atv4</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">63</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">n_seed_atv4</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">y_train</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;RandomForestClassifier&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="avaliacao">
<h3>3.4.2 Avaliação<a class="headerlink" href="#avaliacao" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_full</span><span class="p">,</span> <span class="n">axes_full</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;importances_std&#39;</span><span class="p">],</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia Média&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Importancia Média das Features&#39;</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">axes_full</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">fig_full</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_full</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05_bar_pfi_selected.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_full</span><span class="p">,</span> <span class="n">axes_full</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;importances_mean&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">yerr</span><span class="o">=</span><span class="n">data_result</span><span class="p">[</span><span class="n">condition</span><span class="p">][</span><span class="s1">&#39;importances_std&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Features&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes_full</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Importancia Média&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;data_result&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/222d22c5eda51f32220575000b6fd3cb6e5ab78acfff0bdc736a57c072d07fb8.png" src="../../_images/222d22c5eda51f32220575000b6fd3cb6e5ab78acfff0bdc736a57c072d07fb8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">partial_model_metrics</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">features</span><span class="p">,</span>
    <span class="n">which_metrics</span><span class="o">=</span><span class="n">which_metrics</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span>
<span class="p">)</span>
<span class="n">partial_model_metrics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">65</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">partial_model_metrics</span> <span class="o">=</span> <span class="n">calculate_metrics</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">model</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">features</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">which_metrics</span><span class="o">=</span><span class="n">which_metrics</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">cv</span><span class="o">=</span><span class="n">cv</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">partial_model_metrics</span>

<span class="ne">NameError</span>: name &#39;calculate_metrics&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">full_model_metrics</span><span class="p">,</span> <span class="n">partial_model_metrics</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">full_model_metrics</span><span class="p">,</span> <span class="n">partial_model_metrics</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

<span class="ne">NameError</span>: name &#39;pd&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id9">
<h3>3.4.3 Conclusões<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><strong>all_features</strong></p></th>
<th class="head"><p><strong>partial_features</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>accuracy</strong></p></td>
<td><p>0.971930</p></td>
<td><p>0.952538</p></td>
</tr>
<tr class="row-odd"><td><p><strong>precision</strong></p></td>
<td><p>0.973400</p></td>
<td><p>0.956618</p></td>
</tr>
<tr class="row-even"><td><p><strong>recall</strong></p></td>
<td><p>0.983175</p></td>
<td><p>0.971984</p></td>
</tr>
<tr class="row-odd"><td><p><strong>f1</strong></p></td>
<td><p>0.977884</p></td>
<td><p>0.962969</p></td>
</tr>
<tr class="row-even"><td><p><strong>roc_auc</strong></p></td>
<td><p>0.968211</p></td>
<td><p>0.946165</p></td>
</tr>
</tbody>
</table>
<p>Após analisar os resultados das validações cruzadas para o modelo utilizando todas as variáveis (<em>full_features</em>) em comparação com o modelo utilizando apenas as <strong>features</strong> estritamente maior que zero (<em>partial_features</em>), podemos observar que ambos os modelos apresentam desempenho bastante semelhante em termos de métricas de avaliação, como <em>accuracy</em>, <em>precision</em>, <em>recall</em>, <em>f1</em> e <em>roc_auc</em>.</p>
<p>Isso sugere uma notável robustez do modelo, mesmo após a retirada das <em>features</em> que têm importância menor ou igual a zero, considerando o modelo geral. O modelo com menos variáveis, que utiliza apenas as que posssuem relevância para a classificação, segundo o <em>PFI</em>, mantém um desempenho praticamente igual ao modelo completo. Essa consistência no desempenho indica que as <em>features</em> removidas não contribuem significativamente para a capacidade do modelo de fazer previsões precisas.</p>
<p>Portanto, a capacidade do modelo de manter um desempenho elevado mesmo após a remoção dessas <em>features</em> ressalta sua robustez e capacidade de generalização. Essa característica é crucial em situações onde a simplificação do modelo pode ser desejável, seja para reduzir a complexidade, melhorar a interpretabilidade ou aumentar a eficiência computacional, sem comprometer sua precisão.</p>
<p>Além disso, apesar do modelo ainda manter uma boa performance apos a retirada das variáveis, ainda houve uma queda das metricas, isso evidencia também que existia alguma relação intrisica das variaveis que foram retiradas para com o target, havendo alguma importância que o método <em>Permutation Feature Importance</em> conseguiu mensurar na sua forma de estimação.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="partial-dependence-plots-pdps-e-individual-conditional-expectation-ices">
<h1>4. Partial Dependence Plots (PDPs) e Individual Conditional Expectation(ICEs)<a class="headerlink" href="#partial-dependence-plots-pdps-e-individual-conditional-expectation-ices" title="Link to this heading">#</a></h1>
<p>Será realizado um <em>Feature Selection</em> utilizando o <em>Permutation Feature Importance</em>, bem como feito na atividade <code class="docutils literal notranslate"><span class="pre">04</span></code>. As <em>features</em> selecionadas serão as que apresentam valor <strong>extritamente maior que zero</strong>, levando em consideração que o método avalia utilizando uma métrica a importancia de uma feature, a medida que os valores dela são perturbados aleatoriamente, e então re-avaliada. Apos isso, é avaliado a diferença entre a métrica selecionada do modelo global menos a métrica avaliada sob a base com a <em>feature</em> aleatorizada.</p>
<p>Sob essas features selecionadas, será feito uma analise mais detalhada da distribuição das instâncias por meio do <em>Boxplot</em>. Por fim, será calculado a matriz de correlação entre as variáveis e então para fins de visualização, será realizado um conjunto de PDPs e ICEs para variáveis e pares de variáveis não correlacionadas.</p>
<section id="analise-da-distribuicao-das-variaveis">
<h2>4.1 Analise da distribuicao das variaveis<a class="headerlink" href="#analise-da-distribuicao-das-variaveis" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_feats</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_test_feats</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;X&#39; is not defined
</pre></div>
</div>
</div>
</div>
<section id="boxplot">
<h3>4.1.1 Boxplot<a class="headerlink" href="#boxplot" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test_feats</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_test_feats</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;X_test_feats&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>É possivel notar que existem variaveis em escalas distintas, dificultando a visualização dos boxplots para analise da distribuicao por variavel. Vamos aplicar uma normalizacao das variaveis para tentar visualizar em conjunto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_std</span> <span class="o">=</span> <span class="n">X_test_feats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_std</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">70</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_std</span> <span class="o">=</span> <span class="n">X_test_feats</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_std</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">X_std</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;X_test_feats&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes_std</span> <span class="o">=</span> <span class="n">X_std</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig_std</span> <span class="o">=</span> <span class="n">axes_std</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="n">fig_std</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_std</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-boxplot_std.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">axes_std</span> <span class="o">=</span> <span class="n">X_std</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig_std</span> <span class="o">=</span> <span class="n">axes_std</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">fig_std</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;X_std&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Podemos notar que existem todas as variaveis aparentam ter uma distribuição com muitas instâncias outliers superiormente, em especial a mean_area e perimeter_error, apresentando uma baixa variabilidade, com presença de outliers superiores.</p>
</section>
<section id="heatmap-das-correlacoes">
<h3>4.1.2 Heatmap das correlacoes<a class="headerlink" href="#heatmap-das-correlacoes" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes_hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">X_test_feats</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig_hm</span> <span class="o">=</span> <span class="n">axes_hm</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_hm</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-hm_corr.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">axes_hm</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">X_test_feats</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig_hm</span> <span class="o">=</span> <span class="n">axes_hm</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">fig_hm</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;sns&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Acima podemos ver que as variaveis apresentam uma baixa correlação em geral entre elas, com excessão de variaveis que são calculadas em cima da featire respectiva, como a mean_area, perimeter_error e mean_perimeter, alem disso mean_texture com worst_texture.</p>
<p>Essas baixas correlações podem dar mais veracidade aos gráficos <em>Partial Dependence Plot</em> (PDPs) e <em>Individual Conditional Expectation</em> (ICE).</p>
</section>
</section>
<section id="partial-dependence-plot-pdps">
<h2>4.2 Partial Dependence Plot (PDPs)<a class="headerlink" href="#partial-dependence-plot-pdps" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_pdp_m1</span><span class="p">,</span> <span class="n">axes_pdp_m1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">disp1</span> <span class="o">=</span> <span class="n">PartialDependenceDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">X_test_feats</span><span class="p">,</span>
    <span class="n">features</span><span class="p">,</span>
    <span class="n">grid_resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">axes_pdp_m1</span>
<span class="p">)</span>
<span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-pdp_byfeature.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_pdp_m1</span><span class="p">,</span> <span class="n">axes_pdp_m1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">disp1</span> <span class="o">=</span> <span class="n">PartialDependenceDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">model</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">X_test_feats</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">features</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">grid_resolution</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">ax</span><span class="o">=</span><span class="n">axes_pdp_m1</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-pdp_byfeature.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;PartialDependenceDisplay&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/4c926a0edd15ccee433e14158cfc7ec541f3372a36054f0597dcd1160fb07dd4.png" src="../../_images/4c926a0edd15ccee433e14158cfc7ec541f3372a36054f0597dcd1160fb07dd4.png" />
</div>
</div>
<p>Algumas informações interessantes podem ser obtidas dos graficos acima.</p>
<ol class="arabic">
<li><p>As variáveis simmetry_error e mean_symmetry  não aprensenta muita mudança na probabilidade do cancer do individuo ser benigno.</p></li>
<li><p>Quase todas (com excessão do symmetry_error), mesmo que pequeno, possui um declinio na probabilidade do cancer ser benigno.</p></li>
<li><p>As proporção de pontos sob o suporte de cada variavel parece bastante balanciada, com excessão do perimeter_error e mean_area.</p></li>
<li><p>As variaveis worst_texture, mean_perimeter, perimeter_error, mean_area e worst_fractal_dimension apresentam comportamentos interessantes, com quedas acentuadas apartir de um ponto de corte no seu respectivo suporte.</p>
<p>4.1. <strong>worst_texture</strong>: existe uma queda das probabilidade no intervalo de 31 a 34, aproximadamente, e apartir ali em diante as probabilidades de ser benigno fica constantes indicando.</p>
<p>4.2. <strong>mean_perimeter</strong>: é nitido uma queda bem acentuada da probabilidade do cancer ser benigno, evidenciando que tumores com, em média, um perimetro menor apresenta menores chances de ser benigno.</p>
<p>4.3. <strong>perimeter_error</strong>: bem como o mean_perimeter, existe uma queda continua ate proximo de um valor de 4, e apartir desse ponto as probabilidades ficam constantes, isso pode se dar por conta da proporcao de instâncias centradas em valores inferiores a 4.</p>
<p>4.4. <strong>mean_area</strong>: assim ocmo o mean_perimeter, tambem é notavel uma queda acentuada das probabilidades de ser benigno, mas tambem podendo ser ocasionada pela forte presenca de instancias no intervalor inferior a 800.</p>
<p>4.5. <strong>worst_fractal_dimension</strong>: possui um comportamento analago aos outros, mas com um declineo mais lento, contudo um declive maior proximo do valor de 0.1, e então ficando mais constant. Isso pode ser justificado pela baixa presenca de instancias maiores que 0.1.</p>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean_smoothness&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_perimeter&quot;</span><span class="p">,</span> <span class="s2">&quot;worst_texture&quot;</span><span class="p">,</span> <span class="s2">&quot;worst_fractal_dimension&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_symmetry&quot;</span><span class="p">]</span>
<span class="n">X_feats_corr</span> <span class="o">=</span> <span class="n">X_test_feats</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">X_feats_corr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">74</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">selected_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;mean_smoothness&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_perimeter&quot;</span><span class="p">,</span> <span class="s2">&quot;worst_texture&quot;</span><span class="p">,</span> <span class="s2">&quot;worst_fractal_dimension&quot;</span><span class="p">,</span> <span class="s2">&quot;mean_symmetry&quot;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">X_feats_corr</span> <span class="o">=</span> <span class="n">X_test_feats</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">X_feats_corr</span>

<span class="ne">NameError</span>: name &#39;X_test_feats&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Vamos utilizar as variaveis acima para gerar os graficos de PDPs em <span class="math notranslate nohighlight">\(\mathbb{R}^{2}\)</span>, respeitando a questão da não correlação entre as features, uma vez que isso pode impactar diretamente em analises das regiões de decisão dos PDPs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_pdp_m1</span><span class="p">,</span> <span class="n">axes_pdp_m1</span> <span class="o">=</span> <span class="n">create_pdp_subplots</span><span class="p">(</span><span class="n">selected_features</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_test_feats</span><span class="p">)</span>
<span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-pdp_pairwise.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig_pdp_m1</span><span class="p">,</span> <span class="n">axes_pdp_m1</span> <span class="o">=</span> <span class="n">create_pdp_subplots</span><span class="p">(</span><span class="n">selected_features</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_test_feats</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">fig_pdp_m1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-pdp_pairwise.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;create_pdp_subplots&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Ao olharmos o gráfico PDP acima, podemos notar ja que a relação entre o mean_symmetry e mean_perimeter, o valor do mean_erimeter independe do valor do mean_symmetry em geral, para definir se é maior ou menor a chance do cancer ser benigno, com excessão de valores maiores do mean_symmetry e menores do mean_perimeter, apresentando uma reducao da probabilidade do cancer ser benigno. Cenário um pouco similar para a relação entre mean_simmetry e worst_fractal_dimension, contudo da para notar que valores menores de ambas as variaveis, uma maior chance do tumor ser benigno, e o inverso é valido também, valores maiores de ambas reduzem a probabilidade do cancer ser benigno.</p>
<p>Alguns pares de variaveis acima, possuem um relacionamento importante, delas podemos listar:</p>
<ol class="arabic simple">
<li><p><strong>mean_smoothness x mean_symmetry</strong>: aonde parece estar bem definido, para valores de mean_smoothness inferiores a 0.08 e menores que 0.19 aproximadamente, as chances sao maiores do cancer ser benigno, e quando aumentamos ambas as features, reduzimos as probabilidades.</p></li>
<li><p><strong>mean_smoothness x worst_texture</strong>: cenário similar ao cenário <em>(1)</em> citado acima.</p></li>
<li><p><strong>worst_fractal_dimension x worst_texture</strong>: temos uma fronteira de decisão ali perto de 0.1 para o worst_fractal_dimension e 30 para o worst_texture, aonde quanto maior para ambos, existe uma redução das probabilidades de ser benigno, contudo isso pode ser justificado pela baixa presenca de instancias com valores maiores em x; além disso, valores menores de ambos indicam um aumento da chance do tumor ser benigno.</p></li>
</ol>
</section>
<section id="individual-conditional-expectation-ice">
<h2>4.3. Individual Conditional Expectation (ICE)<a class="headerlink" href="#individual-conditional-expectation-ice" title="Link to this heading">#</a></h2>
<p>Abaixo vamos gerar algumas ICEs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n_cols</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">n_rows</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">fig_ice</span><span class="p">,</span> <span class="n">axes_ice</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_rows</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="n">axes_ice</span> <span class="o">=</span> <span class="n">axes_ice</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selected_features</span><span class="p">,</span> <span class="n">axes_ice</span><span class="p">):</span>
    <span class="n">disp1</span> <span class="o">=</span> <span class="n">PartialDependenceDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test_feats</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">fig_ice</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">axes_ice</span> <span class="o">=</span> <span class="n">axes_ice</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selected_features</span><span class="p">,</span> <span class="n">axes_ice</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">6</span>     <span class="n">disp1</span> <span class="o">=</span> <span class="n">PartialDependenceDisplay</span><span class="o">.</span><span class="n">from_estimator</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test_feats</span><span class="p">,</span> <span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">fig_ice</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="ne">NameError</span>: name &#39;PartialDependenceDisplay&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/72905c51f0436c3554fd8d2a1eb99b6f8c8af35758efb7bd990f5166ccc8d74a.png" src="../../_images/72905c51f0436c3554fd8d2a1eb99b6f8c8af35758efb7bd990f5166ccc8d74a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_ice</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-05-ices.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_ice</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/72905c51f0436c3554fd8d2a1eb99b6f8c8af35758efb7bd990f5166ccc8d74a.png" src="../../_images/72905c51f0436c3554fd8d2a1eb99b6f8c8af35758efb7bd990f5166ccc8d74a.png" />
</div>
</div>
<p>Focando apenas na variável mean_perimeter, podemos notar que o risco do cancer ser benigno reduz apartir de 75 de perimetro medio, com uma queda bem brusca dos valores. Além disso, podemos notar que apartir do ponto de corte de 100-110, o risco tende a ser constante, mas também podendo ser justificado pela baixa presença de instancias com valores maiores que esse.</p>
</section>
<section id="conclusao">
<h2>4.4 Conclusão<a class="headerlink" href="#conclusao" title="Link to this heading">#</a></h2>
<p>Por fim, podemos notar apartir das métricas que o modelo mantem a robustes, com metricas proximas do modelo completo com todas as features, mesmo apos a seleção de features extritamente positivas. Apos isso, olhando para os PDPs, podemos notar a partial dependence entre pares de features não correlacionadas, tendo algumas com uma fronteira de decisão bem definida entre os tipos de canceres, isso é bastante significante para retirada de insights sobre como o modelo tomou certas decisões ao classificar as instâncias.</p>
<p>Para validação localmente, podemos ter o ICE de cada instância, validando as informações do PDP, aparentemente as instâncias seguem o mesmo comportamento em geral, com respeito a partial dependence.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="local-interpretable-model-agnostic-explanations-lime">
<h1>5. Local Interpretable Model-Agnostic Explanations (LIME)<a class="headerlink" href="#local-interpretable-model-agnostic-explanations-lime" title="Link to this heading">#</a></h1>
<p>Nesta seção, vamos aplicar o LIME para gerar explicações locais para determinadas instâncias, considerando o modelo selecionado apartir das seções anteriores, e com as features selecionadas com feature importance positiva, considerando o método PFI.</p>
<section id="selecionando-instancias">
<h2>5.1 Selecionando instâncias<a class="headerlink" href="#selecionando-instancias" title="Link to this heading">#</a></h2>
<p>Nessa seção, o intuito será pegar as instâncias mais importantes para ambas as classes, com o intuito de definir os individuos mais representativos daquele grupo, e que maximizem a probabilidade de classe.</p>
<p>Mais a frente, também será selecionado instâncias ja apresentam probabilidades inferiores de pertencimento a determinada classe.</p>
<section id="id10">
<h3>5.1.1 Aplicando PCA<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>Abaixo será aplicado um PCA para conseguir visualizar as instâncias em <span class="math notranslate nohighlight">\(\mathbb{R}^{2}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">X_std</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">X_std</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;PCA&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="selecionando-as-instancias-mais-representativas-por-classe">
<h3>5.1.2 Selecionando as instancias mais representativas por classe<a class="headerlink" href="#selecionando-as-instancias-mais-representativas-por-classe" title="Link to this heading">#</a></h3>
<p>Será selecionado instancias mais representativas por grupo, baseando-se  na media das features, e então aplicando o PCA para a visualização em <span class="math notranslate nohighlight">\(\mathbb{R}^{2}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_centers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
    <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">X_centers</span> <span class="o">=</span> <span class="p">{</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="s2">&quot;c0&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="s2">&quot;c1&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="p">}</span>

<span class="ne">NameError</span>: name &#39;X_train&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_c0_center</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">])</span>
<span class="n">X_c1_center</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">X_c0_center</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">X_c1_center</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;pca&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualizando">
<h3>5.1.3 Visualizando<a class="headerlink" href="#visualizando" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">39</span><span class="p">)</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">39</span><span class="p">)</span>
<span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">39</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">y_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">39</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">y_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_values</span><span class="p">,</span> <span class="n">y_values</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;X_std&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_i</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_grid</span><span class="p">,</span>
    <span class="n">y_grid</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;bs&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;class = 0&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;g^&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;class = 1&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;centroides&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_i</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-scatter_centers.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">82</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_i</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">x_grid</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">y_grid</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="s2">&quot;bs&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;class = 0&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">X_std</span><span class="p">[</span><span class="n">y_train</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="s2">&quot;g^&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;class = 1&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;x_grid&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/21c37ffbd6bdb6f66a479556953e1fad74c45769bedbe25de1ea8e0b7d368cea.png" src="../../_images/21c37ffbd6bdb6f66a479556953e1fad74c45769bedbe25de1ea8e0b7d368cea.png" />
</div>
</div>
</section>
<section id="utilizando-as-probabilidades-de-pertencimento-a-classe-positiva">
<h3>5.1.4 Utilizando as probabilidades de pertencimento a classe positiva<a class="headerlink" href="#utilizando-as-probabilidades-de-pertencimento-a-classe-positiva" title="Link to this heading">#</a></h3>
<p>Vamos tentar ilustrar um pouco melhor o gráfico acima, utilizando a classe positiva como referência, adicionado a probabilidade de pertencimento a classe positiva como informação ao gráfico</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_probs</span><span class="p">,</span> <span class="n">axes_probs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_grid</span><span class="p">,</span>
    <span class="n">y_grid</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>
<span class="p">)</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]),</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;centroides&quot;</span>
<span class="p">)</span>
<span class="n">fig_probs</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes_probs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Probability&#39;</span><span class="p">)</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_i</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-scatter_centers.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_i</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-probs_scatter_centers.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">fig_probs</span><span class="p">,</span> <span class="n">axes_probs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">x_grid</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">y_grid</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">scatter</span> <span class="o">=</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">c</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="n">features</span><span class="p">])[:,</span> <span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]]),</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X_c0_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">X_c1_center</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]]),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;centroides&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;x_grid&#39; is not defined
</pre></div>
</div>
<img alt="../../_images/5cfe55edb8e0e6ee74d0e54c0fe91f6b9e07c6c6e5df87fdca620bfa6ce08985.png" src="../../_images/5cfe55edb8e0e6ee74d0e54c0fe91f6b9e07c6c6e5df87fdca620bfa6ce08985.png" />
</div>
</div>
</section>
<section id="selecionando-mais-algumas-instancias">
<h3>5.1.5 Selecionando mais algumas instâncias<a class="headerlink" href="#selecionando-mais-algumas-instancias" title="Link to this heading">#</a></h3>
<p>Nesta seção, vamos selecionar duas instâncias a mais para analise sob o <em>Local Interpretable Model-Agnostic Explanations</em> (LIME), sendo eles seguindo as seguintes caracteristicas:</p>
<ol class="arabic simple">
<li><p>Instância distante do grupo da classe postiva;</p></li>
<li><p>Instância no exato ponto médio entre os centroides;</p></li>
<li><p>Instância em local com mais sobreposicao de classes.</p></li>
</ol>
<p>Para o ponto (1.), vamos selecionar a instancia mais distante de ambos os grupos.</p>
<p>Já para o ponto (2.), vamos calcular o ponto médio entre os centroides de cada grupo.</p>
<p>exemplo:
$<span class="math notranslate nohighlight">\(
x_{pm} = \frac{x^{(0)}_{pm} + x^{(1)}_{pm}}{2}
\)</span>$</p>
<p>e</p>
<div class="math notranslate nohighlight">
\[
y_{pm} = \frac{y^{(0)}_{pm} + y^{(1)}_{pm}}{2}
\]</div>
<p>Para o ponto (3.), sera selecionado manualmente a instância.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_feats_1</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y_true_1</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">84</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">x_feats_1</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">y_true_1</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">))[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;X_train&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_pm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_pm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">85</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">x_pm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_pm</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;X_centers&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_feats_2</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
    <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">91.9109803837386</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.880924007768748</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span>
<span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y_true_2</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">91.9109803837386</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.880924007768748</span><span class="p">))[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_feats_2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">86</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">x_feats_2</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">91.9109803837386</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.880924007768748</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="p">][</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">y_true_2</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">91.9109803837386</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">X_std</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.880924007768748</span><span class="p">))[</span><span class="mi">0</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x_feats_2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;X_train&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância afastada&quot;</span>
<span class="p">)</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_probs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância afastada&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">fig_probs</span>

<span class="ne">NameError</span>: name &#39;x1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;#219795&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância no ponto médio&quot;</span>
<span class="p">)</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_probs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;#219795&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância no ponto médio&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">fig_probs</span>

<span class="ne">NameError</span>: name &#39;x2&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;#e2ad32&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância em região com sobreposicao&quot;</span>
<span class="p">)</span>
<span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_probs</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-probs_scatter_instances.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_probs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;#e2ad32&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância em região com sobreposicao&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes_probs</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">fig_probs</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-probs_scatter_instances.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="o">**</span><span class="n">_fig_params</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;x3&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância afastada&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;#219795&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância no ponto médio&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;#553bd8&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância em região com sobreposicao&quot;</span>
<span class="p">)</span>
<span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig_i</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
    <span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;atv-06-scatter_centers_instances.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext_type_fig</span><span class="p">),</span>
    <span class="o">**</span><span class="n">_fig_params</span>
<span class="p">)</span>
<span class="n">fig_i</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="s2">&quot;ko&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância afastada&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância no ponto médio&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>     <span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span>     <span class="n">label</span><span class="o">=</span><span class="s2">&quot;instância em região com sobreposicao&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;x1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p><strong><span class="math notranslate nohighlight">\(pca_{X_1}\)</span></strong></p></th>
<th class="head"><p><strong><span class="math notranslate nohighlight">\(pca_{X_2}\)</span></strong></p></th>
<th class="head"><p><strong>true label</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>instância afastada</strong></p></td>
<td><p>1850.4459</p></td>
<td><p>-3.592414</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><strong>instância no ponto médio</strong></p></td>
<td><p>71.951322</p></td>
<td><p>0.495681</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><strong>instância em região com sobreposição</strong></p></td>
<td><p>-91.91098038</p></td>
<td><p>5.88092401</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><strong>centroide classe negativa</strong></p></td>
<td><p>337.105269</p></td>
<td><p>2.322356</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-even"><td><p><strong>centroide classe positiva</strong></p></td>
<td><p>-193.202625</p></td>
<td><p>-1.330995</p></td>
<td><p>-</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="lime">
<h2>5.2 LIME<a class="headerlink" href="#lime" title="Link to this heading">#</a></h2>
<p>Nesta seção, vamos aplicar o LIME sob as instâncias selecionadaras anteriormente, listadas na tabela acima.</p>
<section id="fit-a-classe-criada-para-o-lime">
<h3>5.2.1 Fit a classe criada para o LIME<a class="headerlink" href="#fit-a-classe-criada-para-o-lime" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span> <span class="o">=</span> <span class="n">LimeExplainer</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">model</span><span class="p">)</span>
<span class="n">le</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
    <span class="n">class_names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span> <span class="o">=</span> <span class="n">LimeExplainer</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">model</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">le</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;classification&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">class_names</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">random_state</span><span class="o">=</span><span class="n">n_seed</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="p">)</span>

<span class="ne">NameError</span>: name &#39;LimeExplainer&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="explain-instance-para-cada-uma-das-situacoes-da-secao-anterior">
<h3>5.2.2 Explain Instance: para cada uma das situações da seção anterior<a class="headerlink" href="#explain-instance-para-cada-uma-das-situacoes-da-secao-anterior" title="Link to this heading">#</a></h3>
<section id="centroide-da-classe-negativa">
<h4>5.2.2.1 Centroide da classe negativa<a class="headerlink" href="#centroide-da-classe-negativa" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe 0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe 0</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_c0.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_c0.html&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>obs.: caso nao carregue a imagem, clique <a class="reference external" href="https://raw.githack.com/Manuelfjr/topicos_avancados_ic_ii/develop/assets/lime_c0.html">aqui</a>.</p>
<p>Nesse cenário, o intuito é mostrar quais são as variáveis mais importante para a instância que, em termos da média, melhor representa o grupo da classe 0. Dessa forma, podemos notar que a probabilidade de pertencimento a esse grupo para essa isntância é 1,  mostrando que valores de variaveis como perimeter_error &gt; 3.33 ou mean_area &gt; 776.17 para uma instância foram bem impactantes para essa instância localmente.</p>
</section>
<section id="centroide-da-classe-positiva">
<h4>5.2.2.2 Centroide da classe positiva<a class="headerlink" href="#centroide-da-classe-positiva" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">94</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe 1</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_c1.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">95</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_c1.html&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>obs.: caso nao carregue a imagem, clique <a class="reference external" href="https://raw.githack.com/Manuelfjr/topicos_avancados_ic_ii/develop/assets/lime_c1.html">aqui</a>.</p>
<p>Diferente da situação da seção (5.2.2.1), essa isntância que, em termos da média, melhor representa o grupo positivo, podemos notar que para as mesmas variáveis perimeter_error e mean_area, possuem valores bem  diferente, aonde temos perimeter_error &lt; 1.6, mean_area &gt; 418.98 e mean_perimeter &lt; 75.04, mostrando que para a classificação dessa instância em especifico essas featuresd foram mais importantes.</p>
</section>
<section id="instancia-mais-distante-do-grupo-positivo">
<h4>5.2.2.3 Instância mais distante do grupo positivo<a class="headerlink" href="#instancia-mais-distante-do-grupo-positivo" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True label: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_true_1</span><span class="p">))</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia mais distante do grupo 01</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">96</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True label: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_true_1</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia mais distante do grupo 01</span>

<span class="ne">NameError</span>: name &#39;y_true_1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_feats_1.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">97</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_feats_1.html&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>obs.: caso nao carregue a imagem, clique <a class="reference external" href="https://raw.githack.com/Manuelfjr/topicos_avancados_ic_ii/develop/assets/lime_feats_1.html">aqui</a>.</p>
<p>Nesse cenário, temos uma situação similar a seção (5.2.2.1), aonde as mesmas variáveis tiveram maior importancia para a classificação. Como podemos ver, o modelo classificou corretamente essa instância, então a decisão correta foi tomada.</p>
</section>
<section id="instancia-no-ponto-medio-entre-os-centroides">
<h4>5.2.2.4 Instância no ponto médio entre os centroides<a class="headerlink" href="#instancia-no-ponto-medio-entre-os-centroides" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_pm</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia no ponto medio entre os centroides</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">98</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_pm</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia no ponto medio entre os centroides</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_pm.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">99</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_pm.html&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>obs.: caso nao carregue a imagem, clique <a class="reference external" href="https://raw.githack.com/Manuelfjr/topicos_avancados_ic_ii/develop/assets/lime_pm.html">aqui</a>.</p>
<p>Nitidamente podemos notar que o modelo ja apresentou um grau de incerteza maior ao classificar essa instância, apresentando valores de features que se enquadram melhor na classe postiva, contudo predominou a classe negativa, então o ponto médio seria considerado, majoritariamente como da classe 0, segundo o modelo.</p>
</section>
<section id="instancia-em-regiao-com-overlapping">
<h4>5.2.2.5 Instância em região com overlapping<a class="headerlink" href="#instancia-em-regiao-com-overlapping" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True label: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_true_2</span><span class="p">))</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_2</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instância em região com overlapping</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True label: [</span><span class="si">{}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_true_2</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_2</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instância em região com overlapping</span>

<span class="ne">NameError</span>: name &#39;y_true_2&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_feats_2.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explanation</span><span class="o">.</span><span class="n">save_to_file</span><span class="p">(</span><span class="n">path_assets</span> <span class="o">/</span> <span class="s2">&quot;lime_feats_2.html&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>obs.: caso nao carregue a imagem, clique <a class="reference external" href="https://raw.githack.com/Manuelfjr/topicos_avancados_ic_ii/develop/assets/lime_feats_2.html">aqui</a>.</p>
<p>Apesar de haver uma alta incerteza na hora do modelo tomar a decisão, devido a valores de features tambem que se enquadram na classe negativa,o modelo classificou corretamente a instância, apesar  do overllapping, e com uma probabilidade de classe alta, evidenciando uma certa robustez para tratar com casos de overlapping, considerando esse modelo sob o conjunto de dados breast_cancer.</p>
</section>
<section id="overall">
<h4>5.2.2.6 Overall<a class="headerlink" href="#overall" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe negativa</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe positiva</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia mais distante do grupo positiva</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_pm</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia no ponto medio entre os centroides</span>
<span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_2</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instância em região com overlapping</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c0&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe negativa</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">X_centers</span><span class="p">[</span><span class="s2">&quot;c1&quot;</span><span class="p">],</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># centroide classe positiva</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">le</span><span class="o">.</span><span class="n">explain_instance</span><span class="p">(</span><span class="n">x_feats_1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># instancia mais distante do grupo positiva</span>

<span class="ne">NameError</span>: name &#39;le&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Acima, podemos notar que as instancias relacionadas aos ponto medio entre os centroides e a instancia com overlapping, apesar de apresentarem probabilidades de classe altas, os valores das feature importance sao aparentam ter nenhuma variavel significante para a classificacao, evidenciando que o modelo apresentou uma alta incerteza na decisão sobre esses pontos.</p>
</section>
</section>
<section id="id11">
<h3>5.2.3 Conclusão<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<p>O LIME é uma métrica muito boa para avaliação pontualmente de instâncias, aonde é possivel ter uma analise  similar a uma arvore de decisão, podendo evidenciar pontos de cortes para aquela previsão.  O LIME aparenta ser bem interessante quando visamos utilizar métodos mais “agradaveis” para visualizar uma importancia de determinadas previsões, tanto para alguem leigo quanto alguem por dentro da área.</p>
<p>Além de ser uma técnica eficiente, ela consegue auxiliar diretamente na tarefa de prevenção, evidenciando que features estão intrisicamente com a classe positiva ou negativa, um exemplo de cenário disso seria o cenário do conjunto de dados abordado, <em>breast cancer</em>.</p>
</section>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="id12">
<h1>6. Conclusões<a class="headerlink" href="#id12" title="Link to this heading">#</a></h1>
<p>Com base na análise realizada neste trabalho, podemos concluir que a interpretabilidade dos modelos preditivos é crucial para compreender o comportamento e a lógica das suas decições. Foi aplicado uma seleção de modelos utilizando de métodos de validação cruzada, para a escolha do melhor modelo, também aplicando métodos como surrogates, feature importances, partial dependence plots, individual conditional expectation e local interpretable model-agnostic explanations (LIME), pudemos obter insights valiosos sobre como esses modelos estão tomando suas decisões.</p>
<p>Através dessas análises, foi possível identificar quais variáveis são mais relevantes para o modelo obtido apartir da validação cruzada, como elas impactam as previsões e como as relações entre as variáveis influenciam os resultados. Além disso, pudemos compreender melhor como esses modelos estão generalizando para novos dados e se estão capturando os padrões desejados de maneira consistente.</p>
<p>Dessa forma, ao combinar diversas técnicas de interpretabilidade, podemos não apenas construir modelos preditivos precisos, mas também compreender e explicar seu funcionamento de forma mais clara e transparente, sendo bem fundamental não apenas para garantir a confiabilidade e a robustez, mas também para promover a confiança e a aceitação por parte do individuo final. Em resumo, o uso da interpretabilidade de modelos, e suas tecnicas, torna mais fácil o entendimento do comportante do mesmo, diante dos dados.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "manuelfjr/machine-learning-stats",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ml-book/advanced"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../guide/02_notebooks.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Aprendizado Supervisionado</p>
      </div>
    </a>
    <a class="right-next"
       href="../_bibliography/references.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Referências</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Interpretabilidade de Modelos</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#projeto-01">Projeto 01</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introducao">Introdução</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#configuracoes">0. Configurações</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">0.1 Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">0.2 Methods</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">0.3 Parameters</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#selecao-de-modelos">1. Seleção de modelos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-e-metricas">1.1 Modelos e métricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparando-dataset">1.2 Preparando dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#process-dataset">1.2.1 Process dataset</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#split">1.2.2 Split</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#holdout">1.2.3 Holdout</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelagem">1.3 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit">1.3.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metrics">1.3.2 Metrics</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">1.3.3 Overview</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matriz-de-confusao">1.3.4 Matriz de confusão</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arvore-compacta">1.3.5 Arvore compacta</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#curva-roc">1.3.6 Curva ROC</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-validation">1.4 Cross-validation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusoes">1.5 Conclusões</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#surrogates">2. Surrogates</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">2.1 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-black-box-and-white-box-sem-aplicar-pca">2.1.1 Fit <em>black-box</em> and <em>white-box</em> (sem aplicar PCA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aplicando-pca">2.1.2 Aplicando <em>PCA</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#graficos">2.1.3 Gráficos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">2.1.4 Overview</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arvore-de-decisao">2.2 Arvore de decisão</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ambos-modelos-black-box">2.2.1 Ambos modelos <em>black box</em></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#superficie-de-separacao">2.3 Superficie de separação</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aproximando-o-white-box">2.3.1 Aproximando o <em>white box</em></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#aumentando-o-numero-de-dados">2.3.2 Aumentando o número de dados</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#predicoes">2.3.3 Predições</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot">2.3.4 Plot</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">2.4 Conclusões</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">3. Feature Importances</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">3.1 Modelagem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">3.1.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avaliando">3.1.2 Avaliando</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permutation-feature-importance-pfi">3.2 Permutation Feature Importance (PFI)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#full-model">3.2.1 Full model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#por-classe">3.2.2 Por classe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analise">3.2.3 Analise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">3.3 Gráficos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizacao">3.3.1 Visualização</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">3.3.2 Analise</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionado-features-com-importancia-positiva">3.4 Selecionado Features com importancia positiva</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">3.4.1 Fit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#avaliacao">3.4.2 Avaliação</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">3.4.3 Conclusões</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-dependence-plots-pdps-e-individual-conditional-expectation-ices">4. Partial Dependence Plots (PDPs) e Individual Conditional Expectation(ICEs)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analise-da-distribuicao-das-variaveis">4.1 Analise da distribuicao das variaveis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplot">4.1.1 Boxplot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#heatmap-das-correlacoes">4.1.2 Heatmap das correlacoes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-dependence-plot-pdps">4.2 Partial Dependence Plot (PDPs)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#individual-conditional-expectation-ice">4.3. Individual Conditional Expectation (ICE)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusao">4.4 Conclusão</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#local-interpretable-model-agnostic-explanations-lime">5. Local Interpretable Model-Agnostic Explanations (LIME)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-instancias">5.1 Selecionando instâncias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">5.1.1 Aplicando PCA</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-as-instancias-mais-representativas-por-classe">5.1.2 Selecionando as instancias mais representativas por classe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizando">5.1.3 Visualizando</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilizando-as-probabilidades-de-pertencimento-a-classe-positiva">5.1.4 Utilizando as probabilidades de pertencimento a classe positiva</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#selecionando-mais-algumas-instancias">5.1.5 Selecionando mais algumas instâncias</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lime">5.2 LIME</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-a-classe-criada-para-o-lime">5.2.1 Fit a classe criada para o LIME</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explain-instance-para-cada-uma-das-situacoes-da-secao-anterior">5.2.2 Explain Instance: para cada uma das situações da seção anterior</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centroide-da-classe-negativa">5.2.2.1 Centroide da classe negativa</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centroide-da-classe-positiva">5.2.2.2 Centroide da classe positiva</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-mais-distante-do-grupo-positivo">5.2.2.3 Instância mais distante do grupo positivo</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-no-ponto-medio-entre-os-centroides">5.2.2.4 Instância no ponto médio entre os centroides</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#instancia-em-regiao-com-overlapping">5.2.2.5 Instância em região com overlapping</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#overall">5.2.2.6 Overall</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">5.2.3 Conclusão</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">6. Conclusões</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Manuel Ferreira Junior
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>